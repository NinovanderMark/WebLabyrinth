{"version":3,"file":"main.a0e47a4575fa56605275.js","mappings":"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","sources":["webpack://weblabyrinth/./src/ts/base/color.ts","webpack://weblabyrinth/./src/ts/base/vector.ts","webpack://weblabyrinth/./src/ts/game/events/game-event-handler.ts","webpack://weblabyrinth/./src/ts/game/events/game-event.ts","webpack://weblabyrinth/./src/ts/game/events/item-consumed-event.ts","webpack://weblabyrinth/./src/ts/game/events/item-required-event.ts","webpack://weblabyrinth/./src/ts/game/game.ts","webpack://weblabyrinth/./src/ts/game/item.ts","webpack://weblabyrinth/./src/ts/game/level/level.ts","webpack://weblabyrinth/./src/ts/game/level/resources.ts","webpack://weblabyrinth/./src/ts/game/level/room.ts","webpack://weblabyrinth/./src/ts/game/level/rules.ts","webpack://weblabyrinth/./src/ts/game/player.ts","webpack://weblabyrinth/./src/ts/game/raycast.ts","webpack://weblabyrinth/./src/ts/game/world/door.ts","webpack://weblabyrinth/./src/ts/game/world/exit.ts","webpack://weblabyrinth/./src/ts/game/world/game-object.ts","webpack://weblabyrinth/./src/ts/game/world/pickup.ts","webpack://weblabyrinth/./src/ts/game/world/portal.ts","webpack://weblabyrinth/./src/ts/game/world/sprite.ts","webpack://weblabyrinth/./src/ts/game/world/world.ts","webpack://weblabyrinth/./src/ts/presentation/gui-manager.ts","webpack://weblabyrinth/./src/ts/presentation/input.ts","webpack://weblabyrinth/./src/ts/presentation/interface/dialog.ts","webpack://weblabyrinth/./src/ts/presentation/interface/panel.ts","webpack://weblabyrinth/./src/ts/presentation/rendering/renderer.ts","webpack://weblabyrinth/./src/ts/presentation/rendering/view-sprite.ts","webpack://weblabyrinth/./src/ts/presentation/resource-resolver.ts","webpack://weblabyrinth/webpack/bootstrap","webpack://weblabyrinth/./src/index.ts"],"sourcesContent":["export class Color\r\n{\r\n    hue: number;\r\n    saturation: number;\r\n    lightness: number;\r\n    \r\n    constructor(hue: number, saturation: number, lightness: number) {\r\n        this.hue = hue;\r\n        this.saturation = saturation;\r\n        this.lightness = lightness;\r\n    }\r\n}","export class Vector {\r\n    public x: number;\r\n    public y: number;\r\n\r\n    constructor(x: number, y: number) {\r\n        this.x = x;\r\n        this.y = y;\r\n    }\r\n\r\n    add(vector: Vector): Vector {\r\n        return new Vector(this.x + vector.x, this.y + vector.y);\r\n    }\r\n\r\n    multiply(scalar: number): Vector {\r\n        return new Vector(this.x * scalar, this.y * scalar);\r\n    }\r\n\r\n    subtract(vector: Vector): Vector {\r\n        return new Vector(this.x - vector.x, this.y - vector.y);\r\n    }\r\n\r\n    rotateBy(degrees: number): Vector {\r\n        degrees = -degrees * (Math.PI / 180);\r\n        const cos = Math.cos(degrees);\r\n        const sin = Math.sin(degrees);\r\n        const newX = Math.round(10000 * (this.x * cos - this.y * sin)) / 10000;\r\n        const newY = Math.round(10000 * (this.x * sin + this.y * cos)) / 10000;\r\n        return new Vector(newX, newY);\r\n    }\r\n\r\n    magnitude(): number {\r\n        return Math.sqrt((this.x * this.x) + (this.y * this.y));\r\n    }\r\n\r\n    setLength(length: number): Vector {\r\n        const mag = this.magnitude();\r\n        return new Vector(this.x * (length / mag), this.y * (length / mag));\r\n    }\r\n\r\n    normalize(): Vector {\r\n        const mgn = this.magnitude();\r\n        return new Vector(this.x / mgn, this.y / mgn);\r\n    }\r\n\r\n    dot(vector: Vector): number {\r\n        return (this.x * vector.x) + (this.y * vector.y);\r\n    }\r\n\r\n    cross(vector: Vector): number {\r\n        return (this.x * vector.y) - (vector.x * this.y);\r\n    }\r\n\r\n    rotationDiff(vector: Vector): number {\r\n        const result =\r\n            (Math.atan2(this.y, this.x)\r\n            - Math.atan2(vector.y, vector.x)) \r\n            * (180/Math.PI);\r\n        return result\r\n    }\r\n}\r\n","import { GuiManager } from \"../../presentation/gui-manager\";\r\nimport { GameEvent } from \"./game-event\";\r\nimport { Game } from \"../game\";\r\n\r\nexport class GameEventHandler {\r\n    public game: Game;\r\n    public guiManager: GuiManager;\r\n\r\n    constructor(game: Game, gui: GuiManager) {\r\n        this.game = game;\r\n        this.guiManager = gui;\r\n    }\r\n\r\n    public handle(event: GameEvent) {\r\n        event.handle(this);\r\n    }\r\n}","import { GameEventHandler } from \"./game-event-handler\";\r\n\r\nexport abstract class GameEvent {\r\n    public abstract handle(handler: GameEventHandler);\r\n}","import { GameEvent } from \"./game-event\"\r\nimport { GameEventHandler } from \"./game-event-handler\";\r\n\r\nexport class ItemConsumedEvent extends GameEvent {\r\n    public item: string;\r\n\r\n    constructor(itemName: string) {\r\n        super();\r\n        this.item = itemName;\r\n    }\r\n    \r\n    public handle(handler: GameEventHandler) {\r\n        const sprite = handler.game.world.items.get(this.item).texture;\r\n        handler.guiManager.addDialog('Item consumed', sprite, handler.game.world);\r\n    }\r\n}","import { GameEvent } from \"./game-event\";\r\nimport { GameEventHandler } from \"./game-event-handler\";\r\n\r\nexport class ItemRequiredEvent extends GameEvent {\r\n    public item: string;\r\n\r\n    constructor(itemName: string) {\r\n        super();\r\n        this.item = itemName;\r\n    }\r\n\r\n    public handle(handler: GameEventHandler) {\r\n        const sprite = handler.game.world.items.get(this.item).texture;\r\n        handler.guiManager.addDialog('Missing required item', sprite, handler.game.world);\r\n    }\r\n}","import { Room } from \"./level/room\";\r\nimport { Input } from '../presentation/input';\r\nimport { Player } from './player';\r\nimport { Renderer } from '../presentation/rendering/renderer';\r\nimport { World } from './world/world';\r\nimport { Vector } from '../base/vector';\r\nimport { RayCast } from \"./raycast\";\r\nimport { Door } from './world/door';\r\nimport { Pickup } from \"./world/pickup\";\r\nimport { GameEventHandler } from \"./events/game-event-handler\";\r\nimport { GameEvent } from \"./events/game-event\";\r\nimport { GuiManager } from \"../presentation/gui-manager\";\r\nimport { Portal } from \"./world/portal\";\r\nimport { Level } from \"./level/level\";\r\nimport { Exit } from \"./world/exit\";\r\nimport { GameObject } from \"./world/game-object\";\r\n\r\nexport class Game {\r\n    public world: World;\r\n\r\n\tplayer: Player;\r\n\tinput: Input;\r\n\trenderer: Renderer;\r\n\tguiManager: GuiManager;\r\n\tevents: Array<GameEvent>;\r\n\thandler: GameEventHandler;\r\n\t\r\n\tpaused = false;\r\n\tcurrentTileX = 0;\r\n\tcurrentTileY = 0;\r\n\r\n\tcurrentTime = 0;\r\n\tpreviousTime = 0;\r\n\r\n\tconstructor(renderer: Renderer, input: Input, guiManager: GuiManager) {\r\n\t\tthis.renderer = renderer;\r\n\t\tthis.input = input;\r\n\t\tthis.guiManager = guiManager;\r\n\t\tthis.handler = new GameEventHandler(this, guiManager);\r\n\r\n\t\tthis.player = new Player(17, 19);\r\n\t\tthis.events = new Array<GameEvent>();\r\n\t}\r\n\r\n\tpublic loadLevel(urlString: string) {\r\n\t\tconst url = new URL(urlString);\r\n\t\tconsole.log('Loading new room from URL', url.href);\r\n\r\n\t\tfetch(url.href, {\r\n\t\t\tmethod: 'get',\r\n\t\t\tmode: 'cors'\r\n\t\t}).then((response) => {\r\n\t\t\tif ( response.ok ) {\r\n\t\t\t\tresponse.json().then(json => {\r\n\t\t\t\t\tconst level = json as Level;\r\n\t\t\t\t\tlet warnings = Level.validate(level);\r\n\t\t\t\t\tif ( warnings.length > 0) {\r\n\t\t\t\t\t\tconsole.warn('Warnings were returned during room validation', warnings);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( level.name != null ) {\r\n\t\t\t\t\t\tthis.guiManager.enteredLevel(level.name, level.author);\t\t\t\t\t\t\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tthis.initialize(World.from(level, url));\r\n\t\t\t\t})\r\n\t\t\t} else {\r\n\t\t\t\tthrow new Error(`Unable to retrieve room at URL: ${urlString}`);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Initializes the game instance with the specified world\r\n\t * @param world \r\n\t */\r\n\tpublic initialize(world: World) {\r\n\t\tthis.world = world;\r\n\t\tlet oldScore = this.player.score;\r\n\t\tthis.player = new Player(world.playerStart.x + 0.5, world.playerStart.y + 0.5);\r\n\t\tthis.player.rotateBy(-world.playerRotation);\r\n\t\tthis.player.score = oldScore;\r\n\t\tthis.paused = false;\r\n\r\n\t\t// Parse the rules\r\n\t\tthis.guiManager.setScoreVisibility(world.displayScore);\r\n\t\tif ( !world.minimapAllowed) {\r\n\t\t\tthis.renderer.mapVisible = false;\r\n\t\t}\r\n\t\t\r\n\t\tif ( world.resetScore) {\r\n\t\t\tthis.player.score = 0;\r\n\t\t}\r\n\r\n\t\tthis.tick();\r\n\t}\r\n\r\n\tpublic levelEnd(nextLevel: string | null) {\r\n\t\tthis.paused = true;\r\n\t\tthis.guiManager.createEndScreen(this, nextLevel);\r\n\t}\r\n\r\n\t/**\r\n\t * Progresses the game by 1 step, and schedules the next step\r\n\t */\r\n\tpublic tick() {\r\n\t\tif ( this.paused ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (this.previousTime=== 0 ) {\r\n\t\t\tthis.previousTime = performance.now();\r\n\t\t} else {\r\n\t\t\tthis.previousTime = this.currentTime;\r\n\t\t}\r\n\r\n\t\tthis.currentTime = performance.now();\r\n\r\n\t\tconst delta = (this.currentTime - this.previousTime)/1000;\r\n\t\tthis.gameStep(delta);\r\n\t\tthis.world.step(delta);\r\n\r\n\t\tthis.renderer.render(this, delta);\r\n\t\tthis.guiManager.tick(this, delta);\r\n\r\n\t\tthis.events.forEach(e => this.handler.handle(e));\r\n\t\tthis.events = [];\r\n\r\n\t\twindow.requestAnimationFrame(this.tick.bind(this));\r\n\t}\r\n\r\n\tpublic addEvent(event: GameEvent) {\r\n\t\tthis.events.push(event);\r\n\t}\r\n\r\n\tprivate gameStep(delta: number) {\r\n\t\tif ( this.input.keyQueue.length > 0) {\r\n\t\t\tif ( this.input.keyQueue.find((k) => k === 'm') != null) {\r\n\t\t\t\tif  ( this.world.minimapAllowed ) {\r\n\t\t\t\t\tthis.renderer.toggleMap();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis.input.clearQueue();\r\n\t\t}\r\n\r\n\t\t// Interact with objects in the world\r\n\t\tif ( this.input.usePressed || this.input.leftMouseUp ) {\r\n\t\t\tconst ray = RayCast.ray(this.player.position, this.player.direction, this.player.plane, 0, this.world);\r\n\t\t\tif ( ray.hit && ray.perpWallDist < 2 ) {\r\n\t\t\t\tif ( ray.worldObject instanceof Door || ray.worldObject instanceof Exit) {\r\n\t\t\t\t\tray.worldObject.interact(this);\r\n\t\t\t\t}\r\n\t\t\t} \r\n\t\t}\r\n\r\n\t\tif ( !this.input.anyDirectional() && this.input.mouseDragStart == null ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tvar movement = this.getMovementFromInput();\r\n\t\tif ( movement.x === 0 && movement.y === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet newPlayerPos = this.player.position.add(movement);\r\n\r\n\t\t// Out of bounds\r\n\t\tif (newPlayerPos.y > this.world.objects.length || newPlayerPos.y < 0 || \r\n\t\t\tnewPlayerPos.x > this.world.objects[0].length || newPlayerPos.x < 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst currentTile = this.world.objects[this.currentTileY][this.currentTileX];\r\n\t\tconst nextTile = this.world.objects[Math.floor(newPlayerPos.y)][Math.floor(newPlayerPos.x)];\r\n\t\tlet rotationOffset = 0;\r\n\t\tif (nextTile instanceof GameObject ) {\r\n\t\t\tif ( nextTile.collidable() ) { return; }\r\n\t\t\tif ( nextTile instanceof Portal ) {\r\n\t\t\t\trotationOffset = -(nextTile.targetPortal.targetDirection.rotationDiff(nextTile.targetDirection)-180);\r\n\t\t\t\tnewPlayerPos = \r\n\t\t\t\t\tnew Vector(\r\n\t\t\t\t\t\tnewPlayerPos.x - Math.floor(newPlayerPos.x),\r\n\t\t\t\t\t\tnewPlayerPos.y - Math.floor(newPlayerPos.y)\r\n\t\t\t\t\t)\r\n\t\t\t\t\t.rotateBy(rotationOffset)\r\n\t\t\t\t\t.add(nextTile.targetPortal.targetDirection);\r\n\r\n\t\t\t\tif (newPlayerPos.x < 0) {newPlayerPos.x++;}\r\n\t\t\t\tif (newPlayerPos.y < 0) {newPlayerPos.y++;}\r\n\t\t\t\tnewPlayerPos = newPlayerPos.add(nextTile.targetPosition);\r\n\r\n\t\t\t\tconst nudge = nextTile.targetPortal.targetDirection.multiply(0.1);\r\n\t\t\t\twhile (\tMath.floor(newPlayerPos.x) === Math.floor(nextTile.targetPosition.x) &&\r\n\t\t\t\t\tMath.floor(newPlayerPos.y) === Math.floor(nextTile.targetPosition.y)) {\r\n\t\t\t\t\tnewPlayerPos = newPlayerPos.add(nudge);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.player.position = newPlayerPos;\r\n\t\tthis.player.rotateBy(rotationOffset);\r\n\t\tthis.currentTileX = Math.floor(newPlayerPos.x);\r\n\t\tthis.currentTileY = Math.floor(newPlayerPos.y);\r\n\r\n\t\tif ( currentTile instanceof Pickup) {\r\n\t\t\tcurrentTile.onPickup(this.player);\r\n\t\t\tthis.world.objects[this.currentTileY][this.currentTileX] = null;\r\n\t\t\tthis.player.lastItem = performance.now();\r\n\t\t}\r\n\t}\r\n\r\n\tprivate getMovementFromInput(): Vector {\r\n\t\tif ( this.input.leftPressed) {\r\n\t\t\tthis.player.rotateBy(1.5);\r\n\t\t} else if ( this.input.rightPressed) {\r\n\t\t\tthis.player.rotateBy(-1.5);\r\n\t\t}\r\n\r\n\t\tlet xVel = 0;\r\n\t\tlet yVel = 0;\r\n\t\tif ( this.input.upPressed ) {\r\n\t\t\tyVel += this.player.direction.y * this.player.movementSpeed;\r\n\t\t\txVel += this.player.direction.x * this.player.movementSpeed;\r\n\t\t} else if (this.input.downPressed) {\r\n\t\t\tyVel -= this.player.direction.y * this.player.movementSpeed;\r\n\t\t\txVel -= this.player.direction.x * this.player.movementSpeed;\r\n\t\t} \r\n\r\n\t\tif ( this.input.mouseDragStart != null) {\r\n\t\t\tthis.player.rotateBy((this.input.mouseDragStart.x - this.input.mousePosition.x)*0.01);\r\n\t\t\tconst forward = (this.input.mouseDragStart.y - this.input.mousePosition.y) * 0.0005;\r\n\t\t\tif ( forward > 0.01 ) {\r\n\t\t\t\tyVel = this.player.direction.y * Math.min(forward, this.player.movementSpeed)\r\n\t\t\t\txVel = this.player.direction.x * Math.min(forward, this.player.movementSpeed)\r\n\t\t\t} else if (forward < -0.01) {\r\n\t\t\t\tyVel = this.player.direction.y * Math.max(forward, -this.player.movementSpeed)\r\n\t\t\t\txVel = this.player.direction.x * Math.max(forward, -this.player.movementSpeed)\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn new Vector(xVel, yVel);\r\n\t}\r\n};\r\n","export class Item {\r\n    sprite: number;\r\n    amount: number;\r\n    name: string;\r\n\r\n    constructor(name: string, sprite: number, amount: number = 1) {\r\n        this.amount = amount;\r\n        this.sprite = sprite;\r\n        this.name = name;\r\n    }\r\n}","import { Rules } from \"./rules\";\r\nimport { Resources } from \"./resources\";\r\nimport { Room } from \"./room\";\r\n\r\nexport class Level {\r\n    public static readonly supportedFormat = 'basic_v1';\r\n\r\n    public name: string;\r\n    public author: string;\r\n    public format: string;\r\n    public resources: Resources;\r\n    public room: Room;\r\n    public rules: Rules;\r\n\r\n    public static validate(level: Level): Array<string> {\r\n        let warnings = new Array<string>();\r\n        \r\n        if ( level.name == null ) {\r\n            warnings.push('No name was provided for the room');\r\n        }\r\n\r\n        if ( level.author == null) {\r\n            warnings.push('No author was provided for the room');\r\n        }\r\n\r\n        if ( level.format == null ) {\r\n            warnings.push('No file format identifier was provided');\r\n        } else if ( level.format !== this.supportedFormat) {\r\n            warnings.push(`Provided file format of '${level.format}' does not match expected format of ${this.supportedFormat}`);\r\n        }\r\n        if ( level.resources == null) {\r\n            throw new Error('No resource data was specified');\r\n        }\r\n\r\n        if ( level.room == null) {\r\n            throw new Error('No room data was specified');\r\n        }\r\n\r\n        warnings = warnings.concat(Resources.validate(level.resources));\r\n        warnings = warnings.concat(Room.validate(level.room));\r\n\r\n        if ( level.rules == null) {\r\n            warnings.push('No rules data was specified');\r\n        } else {\r\n            warnings = warnings.concat(Rules.validate(level.rules));\r\n        }\r\n\r\n        return warnings;\r\n    }\r\n}","export class Resources {\r\n    public textures: string;\r\n    public sprites: string;\r\n\r\n    public static validate(resources: Resources): Array<string> {\r\n        const warnings = new Array<string>();\r\n        if ( resources.textures == null || resources.textures.length < 1) {\r\n            throw new Error(`Room does not reference a texture file`);\r\n        }\r\n\r\n        if ( resources.sprites == null || resources.sprites.length < 1) {\r\n            throw new Error(`Room does not reference a sprites file`);\r\n        }\r\n        return warnings;\r\n    }\r\n}","import { RoomObject } from \"./room-object\";\r\n\r\nexport class Room {\r\n    public ceiling: string;\r\n    public floor: string;\r\n    public player: Array<number>;\r\n    public objects: Array<RoomObject>;\r\n    public tiles: Array<Array<number>>;\r\n\r\n    public static validate(room: Room): Array<string> {\r\n        const warnings = new Array<string>();\r\n\r\n        if ( room.ceiling == null ) {\r\n            warnings.push('Ceiling was not specified, using default color');\r\n        }\r\n\r\n        if ( room.floor == null) {\r\n            warnings.push('Floor was not specified, using default color');\r\n        }\r\n\r\n        if ( room.player == null) {\r\n            throw new Error('Room contains no player starting position and orientation');\r\n        }\r\n\r\n        if ( room.player.length !== 3) {\r\n            throw new Error(`Room player position and orientation expects 3 arguments, found ${room.player.length}`);\r\n        }\r\n\r\n        if ( room.objects == null || room.objects.length < 1) {\r\n            throw new Error(`Room contains no objects`);\r\n        }\r\n\r\n        if (room.tiles == null || room.tiles.length < 1) {\r\n            throw new Error(`Room contains no tiles`);\r\n        }\r\n\r\n        var tilesWidth = room.tiles[0].length;\r\n        for (let y = 0; y < room.tiles.length; y++) {\r\n            if ( room.tiles[y].length != tilesWidth) {\r\n                console.debug('Faulty row looks like', room.tiles[y]);\r\n                throw new Error(`Irregular row length for row ${y}, expected: ${tilesWidth} actual: ${room.tiles[y].length}`);\r\n            }\r\n\r\n            for (let x = 0; x < room.tiles[y].length; x++) {\r\n                if ( room.tiles[y][x] < 0 || room.tiles[y][x] > room.objects.length) {\r\n                    throw new Error(`Tile reference out of bounds at coordinates ${x},${y}. Should be between 0 and ${room.objects.length}`);\r\n                }\r\n            }\r\n        }\r\n\r\n        return warnings;\r\n    }\r\n}\r\n","export class Rules {\r\n    public allowMinimap: boolean;\r\n    public displayScore: boolean;\r\n    public resetScore: boolean;\r\n\r\n    public static validate(rules: Rules): Array<string> {\r\n        const warnings = new Array<string>();\r\n        if ( rules.allowMinimap == null) {\r\n            warnings.push(Rules.flagNotSetWarning('allowMinimap'));\r\n        }\r\n\r\n        if ( rules.displayScore == null) {\r\n            warnings.push(Rules.flagNotSetWarning('displayScore'));\r\n        }\r\n\r\n        if ( rules.resetScore == null) {\r\n            warnings.push(Rules.flagNotSetWarning('resetScore'));\r\n        }\r\n\r\n        return warnings;\r\n    }\r\n\r\n    private static flagNotSetWarning(flagName: string) : string {\r\n        return `Flag ${flagName} was not set and will be set to the default value`;\r\n    }\r\n}","import { Vector } from '../base/vector';\r\nimport { Item } from \"./item\";\r\n\r\nexport class Player {\r\n    movementSpeed: number = 0.05;\r\n    items: Array<Item> = [];\r\n\r\n    position: Vector;\r\n    direction: Vector;\r\n    plane: Vector;\r\n    lastItem: number = 0;\r\n    score: number = 0;\r\n    \r\n    secretsFound: number = 0;\r\n    scoreItemsFound: number = 0;\r\n    \r\n    constructor(x: number, y: number) {\r\n        this.position = new Vector(x, y);\r\n        this.direction = new Vector(0, -1);\r\n        this.plane = new Vector(0.66, 0);\r\n    }\r\n\r\n    rotateBy(degrees: number) {\r\n        this.direction = this.direction.rotateBy(degrees);\r\n        this.plane = this.plane.rotateBy(degrees);\r\n    }\r\n}","import { World } from \"./world/world\";\r\nimport { Vector } from \"../base/vector\";\r\nimport { ViewSprite } from \"../presentation/rendering/view-sprite\";\r\nimport { Sprite } from \"./world/sprite\";\r\nimport { Door } from \"./world/door\";\r\nimport { GameObject } from \"./world/game-object\";\r\nimport { Portal } from \"./world/portal\";\r\n\r\nexport class RayCastResult {\r\n    public sprites: Array<ViewSprite>;\r\n    public perpWallDist: number;\r\n    public worldObject: GameObject | null;\r\n    public inside: boolean;\r\n    public hit: boolean;\r\n    public side: number;\r\n    public texture: number;\r\n    public direction: Vector;\r\n    public wallX: number;\r\n    public tilesPassed: Array<Vector>;\r\n}\r\n\r\nexport class RayCast {\r\n    public static ray(originPos: Vector, originDir: Vector, originPlane: Vector, cameraX: number, world: World, \r\n        stopOnSprite: boolean = false, startLength: number = 0, maxLength: number = 8192): RayCastResult {\r\n        var rayDirX = originDir.x + originPlane.x * cameraX;\r\n        var rayDirY = originDir.y + originPlane.y * cameraX;\r\n\r\n        // Which box of the map we're in\r\n        var mapX = Math.floor(originPos.x);\r\n        var mapY = Math.floor(originPos.y);\r\n\r\n        // Length of ray from one X or Y-side to next X or Y-side\r\n        var deltaDistX = Math.abs(1/rayDirX);\r\n        var deltaDistY = Math.abs(1/rayDirY);\r\n\r\n        // What direction to step in X or Y-direction (either +1 or -1)\r\n        var stepX;\r\n        var stepY;\r\n\r\n        // Length of array from current position to next X or Y-side\r\n        var sideDistX;\r\n        var sideDistY;\r\n\r\n        // Calculate step and initial sideDist\r\n        if (rayDirX < 0)\r\n        {\r\n            stepX = -1;\r\n            sideDistX = (originPos.x - mapX) * deltaDistX;\r\n        }\r\n        else\r\n        {\r\n            stepX = 1;\r\n            sideDistX = (mapX + 1 - originPos.x) * deltaDistX;\r\n        }\r\n        if (rayDirY < 0)\r\n        {\r\n            stepY = -1;\r\n            sideDistY = (originPos.y - mapY) * deltaDistY;\r\n        }\r\n        else\r\n        {\r\n            stepY = 1;\r\n            sideDistY = (mapY + 1 - originPos.y) * deltaDistY;\r\n        }\r\n\r\n        var hit = 0;\r\n        var wallXOffset = 0;\r\n        var wallYOffset = 0;\r\n        var inside = false\r\n\r\n        const passed: Array<Vector> = [];\r\n        const sprites: Array<ViewSprite> = [];\r\n        var side: number;\r\n        var texNum: number;\r\n        var worldObject: GameObject;\r\n        \r\n        // Perform DDA\r\n        while (hit === 0)\r\n        {\r\n            // Jump to next map square, OR in X-direction, OR in Y-direction\r\n            if (sideDistX < sideDistY)\r\n            {\r\n                sideDistX += deltaDistX;\r\n                mapX += stepX;\r\n                side = 0;\r\n            }\r\n            else\r\n            {\r\n                sideDistY += deltaDistY;\r\n                mapY += stepY;\r\n                side = 1;\r\n            }\r\n\r\n            passed.push(new Vector(mapX, mapY)); // Store the tile the ray passed\r\n\r\n            // Check if ray has hit a wall\r\n            if ( world.objects[mapY][mapX] instanceof GameObject) { \r\n                worldObject = world.objects[mapY][mapX] as GameObject;\r\n            } else { \r\n                continue; \r\n            }\r\n\r\n            if ( worldObject instanceof Sprite ) {\r\n                var viewSprite = new ViewSprite((mapX+0.5) - originPos.x, (mapY+0.5) - originPos.y, worldObject.texture, worldObject, worldObject.scale);\r\n                if ( sprites.findIndex(v => v.x === viewSprite.x && v.y === viewSprite.y) < 0) {\r\n                    sprites.push(viewSprite);\r\n                }\r\n                if ( stopOnSprite ) {\r\n                    hit = 1;\r\n                }\r\n                continue;\r\n            } else if ( worldObject instanceof Door) {\r\n                if ( worldObject.block ) {\r\n                    if ( worldObject.openAmount < 1) {\r\n                        // Distance starts at 1, which is a normal hit, then offset by twice the open amount\r\n                        if (side === 1 && sideDistY - (deltaDistY*(1-worldObject.openAmount*2)) < sideDistX) {\r\n                            hit = 1;\r\n                            texNum = worldObject.texture;\r\n                            wallYOffset = (worldObject.openAmount*2) * stepY;\r\n                        } else if (side === 0 && sideDistX - (deltaDistX*(1-worldObject.openAmount*2)) < sideDistY) {\r\n                            hit = 1;\r\n                            texNum = worldObject.texture;\r\n                            wallXOffset = (worldObject.openAmount*2) * stepX;\r\n                        }\r\n                    }\r\n                } else {\r\n                    texNum = worldObject.texture;\r\n                    hit = 1;\r\n\r\n                    if (side == 1) {\r\n                        wallYOffset = 0.5 * stepY;\r\n                        if (sideDistY - (deltaDistY/2) < sideDistX) { //If ray hits offset wall\r\n                            let wallX = originPos.x + this.perpendicularDistance(mapY, originPos.y, wallYOffset, stepY, rayDirY) * rayDirX;\r\n                            wallX -= Math.floor(wallX);\r\n                            if ( wallX <= worldObject.openAmount){\r\n                                hit = 0; //Continue raycast for open/opening doors\r\n                                wallYOffset = 0;\r\n                            }\r\n                        } else {\r\n                            mapX += stepX;\r\n                            side = 0;\r\n                            inside =  true;\r\n                            wallYOffset = 0;\r\n                            texNum = (world.objects[mapY][mapX] as GameObject).texture;\r\n                        }\r\n                    } else { //side == 0\r\n                        wallXOffset = 0.5 * stepX;\r\n                        if (sideDistX - (deltaDistX/2) < sideDistY) {\r\n                            let wallX = originPos.y + this.perpendicularDistance(mapX, originPos.x, wallXOffset, stepX, rayDirX) * rayDirY;\r\n                            wallX -= Math.floor(wallX);\r\n                            if ( wallX < worldObject.openAmount) {\r\n                                hit = 0;\r\n                                wallXOffset = 0;\r\n                            }\r\n                        } else {\r\n                            mapY += stepY;\r\n                            side = 1;\r\n                            inside = true;\r\n                            wallXOffset = 0;\r\n                            texNum = (world.objects[mapY][mapX] as GameObject).texture;\r\n                        }\r\n                    }\r\n                }\r\n            } else {\r\n                texNum = worldObject.texture;\r\n                hit = 1;\r\n            }\r\n        }\r\n\r\n        var perpWallDist;\r\n        var wallX;\r\n\r\n        // Calculate distance projected on camera direction, and the offset from the start of the wall\r\n        if (side === 0) {\r\n            perpWallDist = this.perpendicularDistance(mapX, originPos.x, wallXOffset, stepX, rayDirX);\r\n            wallX = originPos.y + perpWallDist * rayDirY;\r\n        }\r\n        else {\r\n            perpWallDist = this.perpendicularDistance(mapY, originPos.y, wallYOffset, stepY, rayDirY);\r\n            wallX = originPos.x + perpWallDist * rayDirX;\r\n        }\r\n\r\n        wallX = wallX - Math.floor(wallX);\r\n\r\n        // If the ray hit a portal, we cast another ray from the hit location relative to the target portal\r\n        if (worldObject instanceof Portal && perpWallDist + startLength < maxLength) {\r\n            const angleOffset = -(worldObject.targetPortal.targetDirection.rotationDiff(worldObject.targetDirection) - 180);\r\n            // Convert hit information into vector in entrance portal space\r\n            let newPos = new Vector(wallX * side, !side ? wallX : 0)\r\n                        .rotateBy(angleOffset)\r\n                        .add(worldObject.targetPortal.targetDirection);\r\n            if (newPos.x < 0) {newPos.x++;}\r\n            if (newPos.y < 0) {newPos.y++;}\r\n\r\n            newPos = newPos.add(worldObject.targetPosition);\r\n\r\n            const nudge = worldObject.targetPortal.targetDirection.multiply(0.1);\r\n            while ( Math.floor(newPos.x) === Math.floor(worldObject.targetPosition.x) &&\r\n                    Math.floor(newPos.y) === Math.floor(worldObject.targetPosition.y)) {\r\n                    newPos = newPos.add(nudge);\r\n            }\r\n\r\n            const newDir = originDir.rotateBy(angleOffset);\r\n            const newPlane = originPlane.rotateBy(angleOffset);\r\n\r\n            const castResult = RayCast.ray(newPos, newDir, newPlane, cameraX, world, stopOnSprite, perpWallDist + startLength, maxLength);\r\n\r\n            if ( castResult.sprites.length > 0) {\r\n                let offset = new Vector(wallX * side, !side ? wallX : 0)\r\n                        .add(worldObject.targetDirection)\r\n                if (offset.x < 0) { offset.x++;}\r\n                if (offset.y < 0) { offset.y++;}\r\n\r\n                offset = offset.add(new Vector(mapX - originPos.x, mapY - originPos.y));\r\n\r\n                // Reinterpret sprite position for all sprites discovered by the ray from the portal           \r\n                castResult.sprites.forEach(s => {\r\n                    const spritePos = new Vector(s.x, s.y)\r\n                        .rotateBy(-angleOffset)\r\n                        .add(offset);\r\n\r\n                    sprites.push(new ViewSprite(spritePos.x, spritePos.y, s.sprite, s.gameObject, s.scale));\r\n                });\r\n                \r\n                castResult.sprites = sprites;\r\n                castResult.tilesPassed = castResult.tilesPassed.concat(passed);\r\n            }\r\n\r\n            return castResult;\r\n        }\r\n\r\n        var result = new RayCastResult();\r\n        result.sprites = sprites;\r\n        result.hit = hit === 1;\r\n        result.side = side;\r\n        result.perpWallDist = perpWallDist + startLength;\r\n        result.inside = inside;\r\n        result.worldObject = worldObject;\r\n        result.texture = texNum;\r\n        result.direction = new Vector(rayDirX, rayDirY);\r\n        result.wallX = wallX;\r\n        result.tilesPassed = passed;\r\n        return result;\r\n    }\r\n\r\n    private static perpendicularDistance(map: number, pos: number, wallOffset: number, step: number, rayDir: number) {\r\n        return (map - pos + wallOffset + (1 - step) / 2) / rayDir;\r\n    }\r\n}\r\n","import { GameObject } from \"./game-object\";\r\nimport { DynamicObject } from \"./dynamic-object\";\r\nimport { Interactable } from \"./interactable\";\r\nimport { Game } from \"../game\";\r\nimport { ItemRequiredEvent } from \"../events/item-required-event\";\r\nimport { ItemConsumedEvent } from \"../events/item-consumed-event\"\r\n\r\nexport class Door extends GameObject implements DynamicObject, Interactable {\r\n    public closed: boolean;\r\n    public openAmount: number;\r\n    public block: boolean;\r\n    public openTime: number;\r\n    public key: string | null;\r\n    public secret: boolean;\r\n    public unlockTexture: number;\r\n\r\n    constructor(texture: number, block: boolean = false, secret: boolean = false, key: string | null = null, unlockTexture: number | null = null) {\r\n        super(texture);\r\n        this.closed = true;\r\n        this.openAmount = 0;\r\n        this.openTime = 0;\r\n        this.block = block;\r\n        this.key = key;\r\n        this.secret = secret;\r\n        this.unlockTexture = unlockTexture ?? texture;\r\n    }\r\n\r\n    public override collidable(): boolean {\r\n        return this.openAmount !== 1;\r\n    }\r\n\r\n    public unlock() {\r\n        this.key = null;\r\n        this.texture = this.unlockTexture;\r\n    }\r\n\r\n    public interact(game: Game) {\r\n        if ( this.key != null) {\r\n            const key = this.key;\r\n            const keyIndex = game.player.items.findIndex(i => i.name === this.key && i.amount > 0);\r\n            if ( keyIndex < 0) {\r\n                game.addEvent(new ItemRequiredEvent(key));\r\n                return; // Nothing happens, door is locked\r\n            }\r\n\r\n            game.player.items[keyIndex].amount -= 1;\r\n            this.unlock();\r\n            game.addEvent(new ItemConsumedEvent(key));\r\n            return;\r\n        }\r\n\r\n        if ( this.closed && this.openAmount === 0 ) {\r\n            this.closed = false;\r\n            this.openTime = 0;\r\n            \r\n            if ( this.secret === true) {\r\n                game.player.secretsFound++;\r\n                this.secret = false;\r\n            }\r\n        } else if ( !this.closed && this.openAmount === 1) {\r\n            this.closed = true;\r\n        }\r\n    }\r\n\r\n    public step(delta: number) {\r\n        const amount = this.block ? delta * 0.2 : delta;\r\n        if ( this.closed && this.openAmount > 0) { \r\n            this.openAmount -= amount; \r\n        }\r\n        if ( !this.closed && this.openAmount < 1) { \r\n            console.debug('Opening', amount);\r\n            this.openAmount += amount; \r\n        }\r\n\r\n        if ( this.openAmount > 1) { this.openAmount = 1; }\r\n        if ( this.openAmount < 0) { this.openAmount = 0; }\r\n\r\n        // Automatically start closing the door if it's open for a few seconds\r\n        if ( !this.block) {\r\n            if ( this.openAmount === 1) { this.openTime += delta; }\r\n            if ( this.openTime > 5) { this.closed = true; }\r\n        }\r\n    }\r\n}","import { Game } from \"../game\";\r\nimport { GameObject } from \"./game-object\";\r\nimport { Interactable } from \"./interactable\";\r\n\r\nexport class Exit extends GameObject implements Interactable {\r\n    public nextLevel: string | null;\r\n\r\n    constructor(texture: number, nextLevel: string | null) {\r\n        super(texture);\r\n        this.nextLevel = nextLevel;\r\n    }\r\n\r\n    public interact(game: Game) {\r\n        game.levelEnd(this.nextLevel);\r\n    }\r\n}","export class GameObject {\r\n    public texture: number;\r\n    public seen: boolean = false;\r\n\r\n    constructor(texture: number) {\r\n        this.texture = texture;\r\n    }\r\n\r\n    public collidable(): boolean {\r\n        return true;\r\n    }\r\n}","import { Sprite } from \"./sprite\"\r\nimport { Player } from \"../player\"\r\nimport { Item } from \"../item\";\r\n\r\nexport class Pickup extends Sprite {\r\n    public name: string;\r\n    public amount: number;\r\n\r\n    constructor(sprite: number, name: string, amount: number = 1, scale: number = 1) {\r\n        super(sprite, scale);\r\n        this.amount = amount;\r\n        this.name = name;\r\n    }\r\n\r\n    public override collidable(): boolean {\r\n        return false;\r\n    }\r\n\r\n    public onPickup(player: Player) {\r\n        if ( this.name === 'score') {\r\n            player.score += this.amount;\r\n            player.scoreItemsFound++;\r\n            return;\r\n        }\r\n\r\n        const existing = player.items.findIndex(i => i.name === this.name);\r\n        if ( existing >= 0)  {\r\n            player.items[existing].amount+=this.amount;\r\n            return;\r\n        }\r\n\r\n        player.items.push(new Item(this.name, this.texture, this.amount));\r\n        return;\r\n    }\r\n}\r\n","import { GameObject } from \"./game-object\";\r\nimport { Vector } from \"../../base/vector\";\r\n\r\nexport class Portal extends GameObject {\r\n    public position: Vector;\r\n    public targetPortal: Portal;\r\n    public targetPosition: Vector;\r\n    public targetDirection: Vector;\r\n\r\n    constructor(position: Vector, direction: Vector) {\r\n        super(0);\r\n        this.position = position;\r\n        this.targetDirection = direction;\r\n    }\r\n\r\n    public connect(portal: Portal) {\r\n        this.targetPortal = portal;\r\n        this.targetPosition = portal.position;\r\n        this.targetPortal.targetPortal = this;\r\n        this.targetPortal.targetPosition = this.position;\r\n    }\r\n\r\n    public override collidable(): boolean {\r\n        return false;\r\n    }\r\n}","import { GameObject } from \"./game-object\";\r\n\r\nexport class Sprite extends GameObject{\r\n    public scale: number;\r\n    \r\n    constructor(sprite: number, scale: number = 1) {\r\n        super(sprite);\r\n        this.scale = scale;\r\n    }\r\n\r\n    distanceBetween(x: number, y: number, otherX: number, otherY: number) : number {\r\n        return ((otherX - x) * (otherX - x) + (otherY - y) * (otherY - y));\r\n    }\r\n}","import { GameObject } from \"./game-object\";\r\nimport { DynamicObject } from \"./dynamic-object\";\r\nimport { Door } from \"./door\";\r\nimport { Sprite } from \"./sprite\";\r\nimport { Level } from \"../level/level\";\r\nimport { Exit } from \"./exit\";\r\nimport { Pickup } from \"./pickup\";\r\nimport { Portal } from \"./portal\";\r\nimport { Vector } from \"../../base/vector\";\r\n\r\nexport class World {\r\n    public name: string;\r\n    public author: string;\r\n    public url: URL;\r\n    public objects: Array<Array<GameObject | boolean>>;\r\n    public items: Map<string, Pickup>;\r\n    \r\n    public playerStart: Vector;\r\n    public playerRotation: number;\r\n\tpublic ceiling: string;\r\n\tpublic floor: string;\r\n\r\n    public textures: URL;\r\n    public sprites: URL;\r\n\r\n    public minimapAllowed: boolean;\r\n    public displayScore: boolean;\r\n    public resetScore: boolean;\r\n\r\n    private dynamicObjects: Array<DynamicObject>;\r\n    public scoreItems: number = 0;\r\n    public secrets: number = 0;\r\n\r\n    private constructor() {\r\n        this.objects = [];\r\n        this.dynamicObjects = [];\r\n        this.items = new Map<string, Pickup>();\r\n    }\r\n\r\n    public step(delta: number) {\r\n        this.dynamicObjects.forEach(o => o.step(delta));\r\n    }\r\n\r\n    public cacheDynamicObjects() {\r\n        this.dynamicObjects.splice(0);\r\n        for (let x = 0; x < this.objects.length; x++) {\r\n            for (let y = 0; y < this.objects[x].length; y++) {\r\n                const obj = this.objects[x][y];\r\n                if ( obj instanceof Door ) {\r\n                    this.dynamicObjects.push(obj);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    public static from(level: Level, url: URL): World {\r\n        let pathParts = url.pathname.split('/');\r\n        pathParts.splice(pathParts.length-1, 1);\r\n        const basePath = pathParts.join('/');\r\n\r\n\t\tlet world = new World();\r\n        world.name = level.name;\r\n        world.author = level.author;\r\n        world.url = url;\r\n        world.textures = new URL(`${basePath}/${level.resources.textures}`, url.origin);\r\n        world.sprites = new URL(`${basePath}/${level.resources.sprites}`, url.origin);\r\n\r\n        // Rules\r\n        world.minimapAllowed = level.rules?.allowMinimap ?? true;\r\n        world.displayScore = level.rules?.displayScore ?? true;\r\n        world.resetScore = level.rules?.resetScore ?? false;\r\n\r\n        let room = level.room;\r\n        world.ceiling = room.ceiling != null ? room.ceiling : '#005580';\r\n        world.floor = room.floor != null ? room.floor : '#2b4000';\r\n        world.playerStart = new Vector(room.player[0], room.player[1]);\r\n        world.playerRotation = room.player[2];\r\n\r\n        let portals: Map<number, { portal: Portal, target: number} > = new Map<number, { portal: Portal, target: number}>();\r\n\t\tfor (let y = 0; y < room.tiles.length; y++) {\r\n\t\t\tlet row: Array<GameObject | boolean> = [];\r\n\r\n\t\t\tfor (let x = 0; x < room.tiles[y].length; x++) {\r\n\t\t\t\tconst tile = room.tiles[y][x]-1;\r\n\t\t\t\tif ( tile < 0) {\r\n                    row.push(false);\r\n                } else {\r\n                    const obj = room.objects[tile];\r\n                    switch (obj.type) {\r\n                        case \"block\":\r\n                            row.push(new GameObject(obj[\"texture\"] as number));\r\n                            break;\r\n\r\n                        case \"portal\":\r\n                            const dir = obj[\"targetDirection\"] as Array<number>;\r\n                            const target = obj[\"targetPortal\"] as number;\r\n                            const portal = new Portal(new Vector(x, y), new Vector(dir[0], dir[1]));\r\n                            row.push(portal);\r\n                            portals.set(tile+1, { portal: portal, target: target });\r\n                            break;\r\n\r\n                        case \"door\":\r\n                            const block = obj[\"block\"] as boolean;\r\n                            const unlockTexture = obj[\"texture-unlocked\"] as number | null;\r\n                            const secret = obj[\"secret\"] as boolean | null;\r\n                            row.push(new Door(obj[\"texture\"] as number, block ?? false, secret ?? false, obj[\"key\"] as string, unlockTexture));\r\n                            break;\r\n\r\n                        case \"sprite\":\r\n                            const spriteScale = obj[\"scale\"] as number;\r\n                            row.push(new Sprite(obj[\"texture\"] as number, spriteScale ?? 1));\r\n                            break;\r\n\r\n                        case \"item\":\r\n                            const itemScale = obj[\"scale\"] as number;\r\n                            const amount = obj[\"amount\"] as number;\r\n                            const name = obj[\"name\"];\r\n                            const pickup = new Pickup(obj[\"texture\"] as number, name, amount ?? 1, itemScale ?? 1);\r\n                            row.push(pickup);\r\n                            world.items.set(name, pickup);\r\n                            break;\r\n\r\n                        case \"exit\":\r\n                            const nextLevel = obj[\"next-level\"] as string;\r\n                            row.push(new Exit(obj[\"texture\"] as number, nextLevel));\r\n                            break;\r\n\r\n                        default:\r\n                            throw new Error(`Unknown type '${obj.type}' for object ${tile} at ${x},${y}`);\r\n                    }\r\n                }\r\n\t\t\t}\r\n\r\n            // Increment world counters for certain types of objects\r\n            row.forEach(e => {\r\n                if ( e instanceof Pickup && e.name === 'score') { world.scoreItems++; }\r\n                if ( e instanceof Door && e.secret === true) { world.secrets++; }\r\n            });\r\n\r\n            world.objects.push(row);\r\n\t\t}\r\n\r\n        // Connect related portals\r\n        portals.forEach((v,k) => {\r\n            const target = portals.get(v.target);\r\n            if ( target == null) {\r\n                throw new Error(`Unable to find Portal with id ${v.target}`);\r\n            }\r\n            \r\n            v.portal.connect(target.portal);\r\n        })\r\n\r\n        world.cacheDynamicObjects();\r\n        return world;\r\n\t}\r\n}","import { World } from \"../game/world/world\";\r\nimport { Dialog } from \"./interface/dialog\";\r\nimport { ResourceResolver } from \"./resource-resolver\";\r\nimport { Game } from \"../game/game\";\r\nimport { Panel } from \"./interface/panel\";\r\n\r\nexport class GuiManager {\r\n    resourceResolver: ResourceResolver;\r\n    parentElement: HTMLElement;\r\n    scoreElement: HTMLElement;\r\n\r\n    panel: Panel | null;\r\n    lastScore = -1;\r\n    texWidth = 64;\r\n    texHeight = 64;\r\n\r\n    constructor(resourceResolver: ResourceResolver, parent: HTMLElement) {\r\n        this.resourceResolver = resourceResolver;\r\n        this.parentElement = parent;\r\n        this.scoreElement = document.createElement('p');\r\n        this.scoreElement.classList.add('score');\r\n        this.parentElement.appendChild(this.scoreElement);\r\n    }\r\n\r\n    public enteredLevel(name: string, author: string | null) {\r\n        document.title = `WebLabyrinth - ${name}`;\r\n        let message = name;\r\n        if ( author != null) {\r\n            message =`<strong>${message}</strong><br>By ${author}`;\r\n        }\r\n        \r\n        this.addDialog(message);\r\n    }\r\n\r\n    public setScoreVisibility(visible: boolean) {\r\n        if ( visible && this.scoreElement.classList.contains('hidden')) {\r\n            this.scoreElement.classList.remove('hidden');\r\n        } else if ( !visible && !this.scoreElement.classList.contains('hidden')) {\r\n            this.scoreElement.classList.add('hidden');\r\n        }\r\n    }\r\n\r\n    public addDialog(message: string, sprite: number | null = null, world: World | null = null) {\r\n        if ( this.panel ) {\r\n            let oldElement = this.panel.element;\r\n            this.parentElement.removeChild(oldElement);\r\n        }\r\n\r\n        const element = document.createElement('div');\r\n        element.classList.add('panel');\r\n        element.classList.add('dialog');\r\n        const text = document.createElement('p');\r\n        text.innerHTML = message;\r\n\r\n        if ( sprite != null && world != null) {\r\n            element.appendChild(this.createSpriteCanvas(sprite, world));\r\n        }\r\n        \r\n        element.appendChild(text);\r\n        this.parentElement.appendChild(element);\r\n        this.panel = new Dialog(message, element, sprite);\r\n    }\r\n\r\n    public createEndScreen(game: Game, nextLevel: string | null) {\r\n        if ( this.panel ) {\r\n            this.parentElement.removeChild(this.panel.element);\r\n            this.panel = null;\r\n        }\r\n\r\n        const element = document.createElement('div');\r\n        element.classList.add('panel');\r\n        \r\n        const title = document.createElement('p');\r\n        title.classList.add('title');\r\n        title.innerText = \"Level complete!\";\r\n        element.appendChild(title);\r\n\r\n        // Level information\r\n        if ( game.world.name != null) {\r\n            const levelInfo = document.createElement('div');\r\n            levelInfo.classList.add('level-info');\r\n            element.appendChild(levelInfo);\r\n\r\n            const subtitle = document.createElement('p');\r\n            subtitle.classList.add('name');\r\n            subtitle.innerText = game.world.name;\r\n            levelInfo.appendChild(subtitle);\r\n\r\n            if ( game.world.author != null) {\r\n                const author = document.createElement('p');\r\n                author.classList.add('author');\r\n                author.innerText = game.world.author;\r\n                levelInfo.appendChild(author);\r\n            }\r\n        }\r\n\r\n        const scoreTable = document.createElement('table');\r\n        scoreTable.classList.add('stats');\r\n        const scoreRow = game.world.scoreItems > 0 ? `<tr><td>Score</td><td>${(game.player.scoreItemsFound / game.world.scoreItems )*100}%</td></tr>` : '';\r\n        const secretRow = game.world.secrets > 0 ? `<tr><td>Secrets</td><td>${(game.player.secretsFound / game.world.secrets)*100}%</td></tr>` : '';\r\n        scoreTable.innerHTML = `<tbody>${scoreRow}${secretRow}</tbody>`;\r\n        element.appendChild(scoreTable);\r\n        \r\n        const button = document.createElement('button');\r\n        button.classList.add('btn');\r\n\r\n        if ( nextLevel != null) {\r\n            button.innerText = 'Next level';\r\n            button.onclick = () => game.loadLevel(nextLevel);\r\n\r\n        } else {\r\n            button.innerText = \"Replay\";\r\n            button.onclick = () => game.loadLevel(game.world.url.toString());\r\n        }\r\n\r\n        element.appendChild(button);\r\n\r\n        this.panel = new Panel(element);\r\n        this.parentElement.appendChild(element);\r\n        button.focus();\r\n    }\r\n\r\n    public tick(game: Game, delta: number) {\r\n        if ( this.panel && this.panel instanceof Dialog) {\r\n            this.panel.addDelta(delta);\r\n            if ( this.panel.alive > 4 ) {\r\n                this.parentElement.removeChild(this.panel.element);\r\n                this.panel = null;\r\n            }\r\n        }\r\n\r\n        if ( game.player.score !== this.lastScore) {\r\n            this.lastScore = game.player.score;\r\n            this.scoreElement.innerText = `${this.lastScore}`.padStart(10, '0');\r\n        }\r\n    }\r\n\r\n    private createSpriteCanvas(sprite: number, world: World): HTMLCanvasElement {\r\n        const canvas = document.createElement('canvas');\r\n        canvas.width = this.texWidth;\r\n        canvas.height = this.texHeight;\r\n\r\n        const ctx = canvas.getContext('2d');\r\n        if ( ctx == null ) {\r\n            throw new Error(`Unable to create 2D context`);\r\n        }\r\n\r\n        const sheet = this.resourceResolver.getSprites(world);\r\n        ctx.drawImage(sheet, sprite*this.texWidth, 0, this.texWidth, this.texHeight, 0, 0, this.texWidth, this.texHeight);\r\n        return canvas;\r\n    }\r\n}","import { Vector } from \"../base/vector\";\r\n\r\nexport class Input {\r\n    public upPressed = false;\r\n    public downPressed = false;\r\n    public leftPressed = false;\r\n    public rightPressed = false;\r\n    public usePressed = false;\r\n\r\n    public leftMousePressed = false;\r\n    public previousLeftMousePressed = false;\r\n    public mouseDragStart: Vector | null = null;\r\n    public mousePosition = new Vector(0,0);\r\n    \r\n    public keyQueue = [];\r\n    \r\n    public get leftMouseUp(): boolean {\r\n        if ( this.previousLeftMousePressed) {\r\n            this.previousLeftMousePressed = false;\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    public attachEventListeners(el: HTMLElement) {\r\n        el.addEventListener(\"keydown\", (e: KeyboardEvent) => {\r\n            if (e.key === \"ArrowLeft\") { this.leftPressed = true; }\r\n            else if (e.key === \"ArrowRight\") { this.rightPressed = true; }\r\n            else if (e.key === \"ArrowUp\") { this.upPressed = true; }\r\n            else if (e.key === \"ArrowDown\") { this.downPressed = true; }\r\n            else if (e.key === \" \" ) {this.usePressed = true;}\r\n            else { return; }\r\n\r\n            // Captured input does not bubble up\r\n            e.preventDefault();\r\n        });\r\n\r\n        el.addEventListener(\"keyup\", (e: KeyboardEvent) => {\r\n            if (e.key === \"ArrowLeft\") { this.leftPressed = false; }\r\n            else if (e.key === \"ArrowRight\") { this.rightPressed = false; }\r\n            else if (e.key === \"ArrowUp\") { this.upPressed = false; }\r\n            else if (e.key === \"ArrowDown\") { this.downPressed = false; }\r\n            else if (e.key === \" \" ) {this.usePressed = false; }\r\n            else if (e.key.length === 1 ) { this.keyQueue.push(e.key); }\r\n            else { return; }\r\n            \r\n            // Captured input does not bubble up\r\n            e.preventDefault();\r\n        });\r\n\r\n        el.addEventListener(\"mousedown\", (e: MouseEvent) => {\r\n            if (e.button === 0) {\r\n                const rect = el.getBoundingClientRect();\r\n                this.leftMousePressed = true;\r\n                this.mouseDragStart = new Vector(e.clientX - rect.left, e.clientY - rect.top);\r\n            }\r\n        });\r\n\r\n        el.addEventListener(\"mousemove\", (e: MouseEvent) => {\r\n            const rect = el.getBoundingClientRect();\r\n            this.mousePosition = new Vector(e.clientX - rect.left, e.clientY - rect.top);\r\n        })\r\n\r\n        el.addEventListener(\"mouseup\", (e: MouseEvent) => {\r\n            if ( e.button === 0) {\r\n                this.leftMousePressed = false;\r\n                this.previousLeftMousePressed = true;\r\n                this.mouseDragStart = null;\r\n            }\r\n        });\r\n\r\n        el.addEventListener(\"touchstart\", (e: TouchEvent) => {\r\n            this.leftMousePressed = true;\r\n            const rect = el.getBoundingClientRect();\r\n            const relX = e.changedTouches.item(0).clientX - rect.left;\r\n            const relY = e.changedTouches.item(0).clientY - rect.top;\r\n            this.mouseDragStart = new Vector(relX, relY);\r\n        });\r\n\r\n        el.addEventListener(\"touchmove\", (e: TouchEvent) => {\r\n            const rect = el.getBoundingClientRect();\r\n            const relX = e.changedTouches.item(0).clientX - rect.left;\r\n            const relY = e.changedTouches.item(0).clientY - rect.top;\r\n            this.mousePosition = new Vector(relX, relY);\r\n        });\r\n\r\n        el.addEventListener(\"touchend\", (e: TouchEvent) => {\r\n            this.leftMousePressed = false;\r\n            this.previousLeftMousePressed = true;\r\n            this.mouseDragStart = null;\r\n        });\r\n    }\r\n\r\n    public anyDirectional(): boolean {\r\n        if (this.upPressed || this.downPressed || this.leftPressed || this.rightPressed)\r\n            return true;\r\n\r\n        return false;\r\n    }\r\n\r\n    public clearQueue() {\r\n        this.keyQueue = [];\r\n    }\r\n}\r\n","import {Panel} from \"./panel\";\r\n\r\nexport class Dialog extends Panel {\r\n    public message: string;\r\n    public sprite: number | null;\r\n    public alive: number;\r\n\r\n    constructor(message: string, element: HTMLElement, sprite: number | null = null) {\r\n        super(element);\r\n        this.message = message;\r\n        this.sprite = sprite;\r\n        this.alive = 0;\r\n    }\r\n\r\n    public addDelta(delta: number) {\r\n        this.alive += delta;\r\n    }\r\n}","export class Panel {\r\n    public element: HTMLElement;\r\n\r\n    constructor(element: HTMLElement) {\r\n        this.element = element;\r\n    }\r\n}","import { Game } from \"../../game/game\";\r\nimport { Color } from \"../../base/color\";\r\nimport { Sprite } from \"../../game/world/sprite\";\r\nimport { ViewSprite } from \"./view-sprite\";\r\nimport { Door } from \"../../game/world/door\";\r\nimport { GameObject } from \"../../game/world/game-object\";\r\nimport { RayCast } from \"../../game/raycast\";\r\nimport { ResourceResolver } from \"../resource-resolver\";\r\nimport { Player } from \"../../game/player\";\r\n\r\n\r\nexport class Renderer {\r\n    screenWidth: number;\r\n\tscreenHeight: number;\r\n\tcanvas: HTMLCanvasElement;\r\n\r\n    resourceResolver: ResourceResolver;\r\n\tdrawContext: CanvasRenderingContext2D;\r\n    parentElement: HTMLElement;\r\n    mapVisible: boolean;\r\n\r\n    texWidth = 64;\r\n    texHeight = 64;\r\n\r\n    constructor(width: number, height: number, resResolver: ResourceResolver, canvasElement: HTMLCanvasElement, parent: HTMLElement) {\r\n        this.screenWidth = width;\r\n\t\tthis.screenHeight = height;\r\n\r\n        this.resourceResolver = resResolver;\r\n\t\tthis.canvas = canvasElement;\r\n\t\tthis.canvas.width = this.screenWidth;\r\n\t\tthis.canvas.height = this.screenHeight;\r\n\r\n        let context = this.canvas.getContext('2d');\r\n\t\tif ( context == null) {\r\n\t\t\tthrow new Error(\"Unable to get 2D rendering context from Canvas\");\r\n        }\r\n\r\n\t\tthis.drawContext = context;\r\n        this.drawContext.imageSmoothingEnabled = false;\r\n        this.parentElement = parent;\r\n    }\r\n\r\n    public toggleMap() {\r\n        this.mapVisible = !this.mapVisible;\r\n    }\r\n\r\n    public render(game: Game, delta: number) {\r\n        this.drawContext.fillStyle = \"#000\";\r\n        this.drawContext.fillRect(0,0,this.screenWidth, this.screenHeight);\r\n    \r\n        const textures = this.resourceResolver.getTextures(game.world);\r\n        const sprites = this.resourceResolver.getSprites(game.world);\r\n        \r\n        if ( textures.naturalWidth === 0 || textures.naturalHeight === 0 || \r\n            sprites.naturalWidth === 0  || sprites.naturalHeight === 0) {\r\n            this.drawContext.fillStyle = \"#fff\";\r\n            this.drawContext.font = \"30px Arial\";\r\n            this.drawContext.textAlign = \"center\";\r\n            this.drawContext.fillText(\"Loading textures...\", this.screenWidth/2, this.screenHeight/2);\r\n            return;\r\n        }\r\n\r\n        this.renderCeilingFloor(game);\r\n        this.renderWalls(game, textures, sprites);\r\n        this.renderOverlay(game.player);\r\n\r\n        if ( this.mapVisible ) {\r\n            this.renderMap(game);\r\n        }\r\n\r\n        this.renderInterface(game.player, sprites, delta);\r\n    }\r\n\r\n    private renderOverlay(player: Player) {\r\n        const perf = performance.now()\r\n        if ( perf - player.lastItem < 500 ) {\r\n            const factor = (1 - (perf - player.lastItem) / 500)*0.7;\r\n            this.drawContext.fillStyle = `rgba(255,255,255,${factor})`;\r\n            this.drawContext.fillRect(0, 0, this.screenWidth, this.screenHeight);\r\n        }\r\n    }\r\n\r\n    private renderInterface(player: Player, sprites: HTMLImageElement, delta: number) {\r\n        let left = 16;\r\n        let bottom = 16;\r\n\r\n        player.items.forEach(i => {\r\n            // Don't draw items we have none of, or who are in the special 'score' category\r\n            if ( i.amount < 1 || i.name === 'score' ) {\r\n                return;\r\n            }\r\n\r\n            const width = 48;\r\n            const y = this.screenHeight - (bottom+width);\r\n            for (let n = 0; n < i.amount; n++) {\r\n                this.drawContext.drawImage(sprites, i.sprite*this.texWidth, 0, this.texWidth, this.texHeight, left+(n*width/2), y, width, width);\r\n            }\r\n            bottom+=(width/2 + 8);\r\n        });\r\n    }\r\n\r\n    private renderCeilingFloor(game: Game) {\r\n        // Temporary implementation\r\n        this.drawContext.fillStyle = game.world.ceiling;\r\n        this.drawContext.fillRect(0, 0, this.screenWidth, this.screenHeight/2);\r\n\r\n        this.drawContext.fillStyle = game.world.floor;\r\n        this.drawContext.fillRect(0, this.screenHeight/2, this.screenWidth, this.screenHeight/2);\r\n    }\r\n\r\n    private renderWalls(game: Game, textures: HTMLImageElement, spriteTextures: HTMLImageElement) {\r\n        const pitch = 0;\r\n        const zBuffer: Array<number> = [];\r\n        zBuffer.fill(0, 0, this.screenWidth);\r\n        const sprites: Array<ViewSprite> = [];\r\n\r\n        for(var x = 0; x < this.screenWidth; x++) {\r\n            var cameraX = 2 * x / this.screenWidth - 1; // X coordinate in camera space\r\n            var ray = RayCast.ray(game.player.position, game.player.direction, game.player.plane, cameraX, game.world);\r\n            \r\n            ray.worldObject.seen = true;\r\n            ray.tilesPassed.forEach(t => {\r\n                if ( !(game.world.objects[t.y][t.x] instanceof GameObject)) {\r\n                    game.world.objects[t.y][t.x] = true;\r\n                }\r\n            });\r\n\r\n            if ( ray.sprites ) {\r\n                ray.sprites.forEach(sprite => {\r\n                    if ( sprites.findIndex(s => s.x.toFixed(3) === sprite.x.toFixed(3) && \r\n                        s.y.toFixed(3) === sprite.y.toFixed(3) && s.sprite === sprite.sprite) < 0) {\r\n                            sprite.gameObject.seen = true;\r\n                            sprites.push(sprite);\r\n                    }\r\n                })\r\n            }\r\n            \r\n            // Calculate height of line to draw on screen\r\n            var lineHeight = Math.floor(this.screenHeight / ray.perpWallDist);\r\n\r\n            // Calculate lowest and highest pixel to fill in current stripe\r\n            const drawStart = -lineHeight / 2 + this.screenHeight / 2 + pitch;\r\n            const drawEnd = lineHeight / 2 + this.screenHeight / 2 + pitch;\r\n\r\n            //x coordinate on the texture\r\n            var texX = ray.wallX * this.texWidth;\r\n            if(ray.side == 0 && ray.direction.x > 0) texX = this.texWidth - texX;\r\n            if(ray.side == 1 && ray.direction.y < 0) texX = this.texWidth - texX;\r\n            \r\n            if ( ray.worldObject instanceof Door && !ray.worldObject.block && !ray.inside ) { \r\n                if((ray.side == 0 && ray.direction.x > 0 )|| (ray.side == 1 && ray.direction.y < 0)) {\r\n                    texX += Math.floor(ray.worldObject.openAmount * this.texWidth);\r\n                } else {\r\n                    texX -= Math.floor(ray.worldObject.openAmount * this.texWidth);\r\n                }\r\n                \r\n            }\r\n\r\n            const textureStartX = Math.floor(this.texWidth+(ray.texture*this.texWidth)-texX);\r\n            this.drawContext.drawImage(textures, textureStartX, 0, 1, this.texHeight, x, drawStart, 1, drawEnd - drawStart);\r\n            if ( ray.side === 1 ) { \r\n                this.drawContext.strokeStyle = 'rgba(0,0,0,0.6)';\r\n                this.drawContext.beginPath();\r\n                this.drawContext.moveTo(x, drawStart);\r\n                this.drawContext.lineTo(x, drawEnd);\r\n                this.drawContext.stroke();\r\n            }\r\n\r\n            zBuffer[x] = ray.perpWallDist;\r\n        }\r\n\r\n        // Sort from farthest to closest\r\n        sprites.sort((a: ViewSprite, b: ViewSprite): number => {\r\n            if ( a.y === b.y) {\r\n                return Math.abs(a.x) > Math.abs(b.x) ? -1 : 1;\r\n            } else {\r\n                return Math.abs(a.y) > Math.abs(b.y) ? -1 : 1;\r\n            }\r\n        });\r\n        \r\n        \r\n        sprites.forEach(s => {\r\n            this.renderSpriteBillboard(s, game, zBuffer, pitch, spriteTextures);\r\n        });\r\n    }\r\n\r\n    private renderSpriteBillboard(sprite: ViewSprite, game: Game, zBuffer: Array<number>, pitch: number, texture: HTMLImageElement) {\r\n        const invDet = 1.0 / (game.player.plane.x * game.player.direction.y - game.player.direction.x * game.player.plane.y); //required for correct matrix multiplication\r\n\r\n        const transformX = invDet * (game.player.direction.y * sprite.x - game.player.direction.x * sprite.y);\r\n        const transformY = invDet * (-game.player.plane.y * sprite.x + game.player.plane.x * sprite.y); //this is actually the depth inside the screen, that what Z is in 3D\r\n\r\n        const spriteScreenX = Math.floor((this.screenWidth / 2) * (1 + transformX / transformY));\r\n\r\n        //calculate height of the sprite on screen\r\n        const spriteHeight = Math.abs(Math.floor(this.screenHeight / (transformY))); //using 'transformY' instead of the real distance prevents fisheye\r\n\r\n        //calculate width of the sprite\r\n        const spriteWidth = Math.abs(Math.floor(this.screenHeight / (transformY))) * sprite.scale;\r\n        var drawStartX = Math.floor(-spriteWidth / 2 + spriteScreenX);\r\n        if(drawStartX < 0) drawStartX = 0;\r\n        var drawEndX = spriteWidth / 2 + spriteScreenX;\r\n        if(drawEndX >= this.screenWidth) drawEndX = this.screenWidth - 1;\r\n\r\n        const startY = -((spriteHeight* sprite.scale)/2) + ((spriteHeight/2) - (spriteHeight * sprite.scale)/2) + (this.screenHeight / 2) + pitch;\r\n\r\n        //loop through every vertical stripe of the sprite on screen\r\n        for(var stripe = drawStartX; stripe < drawEndX; stripe++)\r\n        {\r\n            const texX = Math.floor((stripe - (-spriteWidth / 2 + spriteScreenX)) * this.texWidth / spriteWidth);\r\n            //the conditions in the if are:\r\n            //1) it's in front of camera plane so you don't see things behind you\r\n            //2) it's on the screen (left)\r\n            //3) it's on the screen (right)\r\n            //4) ZBuffer, with perpendicular distance\r\n            if(transformY > 0 && stripe > 0 && stripe < this.screenWidth && transformY < zBuffer[stripe]) {\r\n                // Ensure that we don't pick a pixel that's outside the tile, which may happen due to rounding with scaled sprites\r\n                let spriteStartX = Math.min((sprite.sprite * this.texWidth) + texX,(sprite.sprite * this.texWidth) + this.texWidth);\r\n                spriteStartX = Math.max(spriteStartX, (sprite.sprite * this.texWidth));\r\n\r\n                this.drawContext.drawImage(texture, spriteStartX, 0, 1, this.texHeight, stripe, startY, 1, spriteHeight*sprite.scale);\r\n                zBuffer[stripe] = transformY;\r\n            }\r\n        }\r\n    }\r\n\r\n    private renderMap(game: Game) {\r\n        const blockSize = 8;\r\n\r\n        for (var y = 0; y < game.world.objects.length; y++) {\r\n            for (var x = 0; x < game.world.objects[y].length; x++) {\r\n                const obj = game.world.objects[y][x];\r\n                if ( ( !(obj instanceof GameObject) && obj === false) || (obj instanceof GameObject && !obj.seen)) { continue; }\r\n\r\n                var color: Color;\r\n                if ( obj instanceof GameObject) { color = this.getBlockColor(obj.texture+1) }\r\n                else { \r\n                    color = new Color(0, 0, 0);\r\n                }\r\n\r\n                this.drawContext.fillStyle = \"hsl(\" + color.hue + \",\" + color.saturation + \"%,\" + color.lightness + \"%)\";\r\n\r\n                if ( obj instanceof Sprite ) {\r\n                    this.drawContext.fillStyle = '#000';\r\n                    this.drawContext.fillRect(x*blockSize, y*blockSize, blockSize, blockSize);\r\n\r\n                    if ( obj.collidable()) {\r\n                        this.drawContext.strokeStyle = '#f77';\r\n                        this.drawCircle((x+0.5)*blockSize, (y+0.5)*blockSize, blockSize/2);\r\n                    }\r\n                } else if ( obj instanceof Door && !obj.block ) {\r\n                    var neighbour: GameObject | boolean;\r\n                    if ( x > 0) {\r\n                        neighbour = game.world.objects[y][x-1];\r\n                    } else {\r\n                        neighbour = game.world.objects[y][x+1];\r\n                    }\r\n                    if ( neighbour instanceof GameObject ) { this.drawContext.fillRect(x*blockSize, (y+0.25)*blockSize, blockSize, blockSize/2); }\r\n                    else { this.drawContext.fillRect((x+0.25)*blockSize, y*blockSize, blockSize/2, blockSize); }\r\n                } else if ( obj instanceof Door && obj.block && !obj.closed) {\r\n                    this.drawContext.fillStyle = \"#000\";\r\n                    this.drawContext.fillRect(x*blockSize, y*blockSize, blockSize, blockSize);\r\n                } else {\r\n                    this.drawContext.fillRect(x*blockSize, y*blockSize, blockSize, blockSize);\r\n                }\r\n                \r\n                if ( game.currentTileX === x && game.currentTileY === y) {\r\n                    this.drawContext.strokeStyle = '#f0f';\r\n                    this.drawContext.strokeRect(x*blockSize, y*blockSize, blockSize, blockSize);\r\n                }\r\n            }\r\n        }\r\n\r\n        const playerX = game.player.position.x*blockSize;\r\n        const playerY = game.player.position.y*blockSize;\r\n        this.drawContext.strokeStyle = \"#fff\";\r\n        this.drawCircle(playerX, playerY, blockSize/2);\r\n        this.drawContext.beginPath();\r\n        this.drawContext.moveTo(playerX, playerY);\r\n        this.drawContext.lineTo(playerX + game.player.direction.x*blockSize, playerY + game.player.direction.y*blockSize);\r\n        this.drawContext.stroke();\r\n    }\r\n\r\n    private drawCircle(x: number, y: number, r: number) {\r\n        this.drawContext.beginPath();\r\n        this.drawContext.arc(x, y, r, 0, 2 * Math.PI);\r\n        this.drawContext.stroke(); \r\n    }\r\n\r\n    private getBlockColor(blockId: number): Color {\r\n        var hue = 0;\r\n        var saturation = 100;\r\n        var lightness = 50\r\n\r\n        switch(blockId) {\r\n            case 0: // Empty\r\n                saturation = 0;\r\n                lightness = 0;\r\n                break;\r\n            \r\n            default:\r\n                hue = blockId*40;\r\n                break; \r\n        }\r\n\r\n        return new Color(hue, saturation, lightness);\r\n    }\r\n}\r\n","import { GameObject } from \"../../game/world/game-object\";\r\n\r\nexport class ViewSprite {\r\n    public x: number;\r\n    public y: number;\r\n    public sprite: number;\r\n    public scale: number;\r\n    public gameObject: GameObject;\r\n\r\n    constructor(x: number, y: number, sprite: number, gameObject: GameObject, scale: number = 1) {\r\n        this.x = x;\r\n        this.y = y;\r\n        this.sprite = sprite;\r\n        this.scale = scale;\r\n        this.gameObject = gameObject;\r\n    }\r\n\r\n    distanceTo(x: number, y: number) : number {\r\n        return ((x - this.x) * (x - this.x) + (y - this.y) * (y - this.y));\r\n    }\r\n}","import { World } from \"../game/world/world\";\r\n\r\nexport class ResourceResolver {\r\n    public parentElement: HTMLElement;\r\n    public images: Map<string, HTMLImageElement>;\r\n\r\n    constructor(parent: HTMLElement) {\r\n        this.parentElement = parent;\r\n        this.images = new Map<string, HTMLImageElement>();\r\n    }\r\n\r\n    getTextures(world: World): HTMLImageElement {\r\n        let textureImage = this.images.get(world.textures.href);\r\n        if ( textureImage != null ) {\r\n            return textureImage;\r\n        }\r\n\r\n        return this.addResource(world.textures.href);\r\n    }\r\n\r\n    getSprites(world: World): HTMLImageElement {\r\n        let spriteImage = this.images.get(world.sprites.href);\r\n        if ( spriteImage != null ) {\r\n            return spriteImage;\r\n        }\r\n\r\n        return this.addResource(world.sprites.href);\r\n    }\r\n\r\n    private addResource(url: string): HTMLImageElement {\r\n        const img = document.createElement('img');\r\n        img.src = url;\r\n        img.classList.add('hidden');\r\n        this.parentElement.appendChild(img);\r\n        this.images.set(url, img);\r\n        return img;\r\n    }\r\n}","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","import { Game } from \"./ts/game/game\";\r\nimport { ResourceResolver } from \"./ts/presentation/resource-resolver\";\r\nimport { Input } from \"./ts/presentation/input\";\r\nimport { Renderer } from \"./ts/presentation/rendering/renderer\";\r\nimport { GuiManager } from \"./ts/presentation/gui-manager\";\r\n\r\nconst input = new Input();\r\ninput.attachEventListeners(document.getElementsByTagName('body')[0]);\r\n\r\nconst width = 1024;\r\nconst height = 768;\r\nconst canvas = document.getElementById(\"canvas\") as HTMLCanvasElement;\r\nconst depth = document.getElementById(\"depth\") as HTMLCanvasElement;\r\nconst parent = document.getElementById(\"client-parent\") as HTMLElement;\r\nparent.style.maxWidth = `${width}px`;\r\n\r\nconst resources = new ResourceResolver(parent);\r\nconst renderer = new Renderer(width, height, resources, canvas, depth);\r\nconst guiManager = new GuiManager(resources, parent);\r\nconst game = new Game(renderer, input, guiManager);\r\n\r\nvar url = new URL(\"./assets/room.json\", document.baseURI).href; // Local room is fallback\r\n\r\nconst params = new URLSearchParams(window.location.search);\r\nif ( params.get('url') != null) {\r\n    url = params.get('url');\r\n} \r\n\r\ngame.loadLevel(url);\r\n"],"names":["Color","hue","saturation","lightness","this","x","y","add","vector","Vector","multiply","scalar","subtract","rotateBy","degrees","Math","PI","cos","sin","round","magnitude","sqrt","setLength","length","mag","normalize","mgn","dot","cross","rotationDiff","atan2","game","gui","guiManager","handle","event","GameEventHandler","GameEvent","itemName","item","handler","sprite","world","items","get","texture","addDialog","ItemConsumedEvent","ItemRequiredEvent","renderer","input","paused","currentTileX","currentTileY","currentTime","previousTime","player","Player","events","Array","loadLevel","urlString","url","URL","console","log","href","fetch","method","mode","then","response","ok","Error","json","level","warnings","Level","validate","warn","name","enteredLevel","author","initialize","World","from","oldScore","score","playerStart","playerRotation","setScoreVisibility","displayScore","minimapAllowed","mapVisible","resetScore","tick","levelEnd","nextLevel","createEndScreen","performance","now","delta","gameStep","step","render","forEach","e","window","requestAnimationFrame","bind","addEvent","push","keyQueue","find","k","toggleMap","clearQueue","usePressed","leftMouseUp","ray","RayCast","position","direction","plane","hit","perpWallDist","worldObject","Door","Exit","interact","anyDirectional","mouseDragStart","movement","getMovementFromInput","newPlayerPos","objects","currentTile","nextTile","floor","rotationOffset","GameObject","collidable","Portal","targetPortal","targetDirection","targetPosition","nudge","Pickup","onPickup","lastItem","leftPressed","rightPressed","xVel","yVel","upPressed","movementSpeed","downPressed","mousePosition","forward","min","max","Game","Item","amount","format","supportedFormat","resources","room","concat","Resources","Room","rules","Rules","textures","sprites","ceiling","tiles","tilesWidth","debug","allowMinimap","flagNotSetWarning","flagName","secretsFound","scoreItemsFound","RayCastResult","originPos","originDir","originPlane","cameraX","stopOnSprite","startLength","maxLength","stepX","stepY","sideDistX","sideDistY","rayDirX","rayDirY","mapX","mapY","deltaDistX","abs","deltaDistY","side","texNum","wallX","wallXOffset","wallYOffset","inside","passed","Sprite","viewSprite","ViewSprite","scale","findIndex","v","block","openAmount","perpendicularDistance","newPos","newDir","newPlane","castResult","s","spritePos","gameObject","tilesPassed","result","map","pos","wallOffset","rayDir","secret","key","unlockTexture","closed","openTime","unlock","keyIndex","i","seen","existing","connect","portal","distanceBetween","otherX","otherY","scoreItems","secrets","dynamicObjects","Map","o","cacheDynamicObjects","splice","obj","pathParts","pathname","split","basePath","join","origin","portals","row","tile","type","dir","target","set","spriteScale","itemScale","pickup","resourceResolver","parent","lastScore","texWidth","texHeight","parentElement","scoreElement","document","createElement","classList","appendChild","title","message","visible","contains","remove","panel","oldElement","element","removeChild","text","innerHTML","createSpriteCanvas","Dialog","innerText","levelInfo","subtitle","scoreTable","scoreRow","secretRow","button","onclick","toString","Panel","focus","addDelta","alive","padStart","canvas","width","height","ctx","getContext","sheet","getSprites","drawImage","GuiManager","leftMousePressed","previousLeftMousePressed","attachEventListeners","el","addEventListener","preventDefault","rect","getBoundingClientRect","clientX","left","clientY","top","relX","changedTouches","relY","Input","resResolver","canvasElement","screenWidth","screenHeight","context","drawContext","imageSmoothingEnabled","fillStyle","fillRect","getTextures","naturalWidth","naturalHeight","font","textAlign","fillText","renderCeilingFloor","renderWalls","renderOverlay","renderMap","renderInterface","perf","factor","bottom","n","spriteTextures","zBuffer","fill","t","toFixed","lineHeight","drawStart","drawEnd","texX","textureStartX","strokeStyle","beginPath","moveTo","lineTo","stroke","sort","a","b","renderSpriteBillboard","pitch","invDet","transformX","transformY","spriteScreenX","spriteHeight","spriteWidth","drawStartX","drawEndX","startY","stripe","spriteStartX","color","getBlockColor","drawCircle","blockSize","strokeRect","playerX","playerY","r","arc","blockId","Renderer","distanceTo","images","textureImage","addResource","spriteImage","img","src","ResourceResolver","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","exports","module","__webpack_modules__","call","getElementsByTagName","getElementById","style","maxWidth","baseURI","URLSearchParams","location","search"],"sourceRoot":""}