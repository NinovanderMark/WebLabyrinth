(()=>{"use strict";var t={937:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Color=void 0;e.Color=function(t,e,r){this.hue=t,this.saturation=e,this.lightness=r}},934:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Game=void 0;var i=r(993),s=r(584),n=function(){function t(t,e){this.walls=[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2],[4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,3,0,0,0,2],[4,0,0,0,0,0,0,2,2,2,2,2,2,0,0,3,0,3,3,3,0,0,0,2],[4,0,3,3,0,0,0,2,0,0,0,0,2,0,0,0,0,0,0,3,0,0,0,2],[4,0,3,3,0,0,2,2,0,2,2,0,2,0,0,3,3,3,0,3,0,0,0,2],[4,0,3,3,0,0,2,0,0,0,2,0,2,0,0,3,0,0,0,3,0,0,0,2],[4,0,3,3,0,0,2,0,0,0,0,0,2,0,0,3,0,3,3,3,0,0,0,2],[4,0,0,0,0,0,2,0,0,0,2,2,2,0,0,0,0,0,0,0,0,0,0,2],[4,0,0,0,0,0,2,2,0,2,2,0,0,0,0,3,0,3,0,3,0,0,0,2],[4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2],[4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2],[4,0,1,0,0,1,0,0,0,0,0,5,5,5,5,5,0,0,0,0,0,0,0,2],[4,0,0,0,0,1,0,0,0,0,0,0,0,0,0,5,0,0,0,0,0,0,0,2],[4,0,0,0,0,1,0,0,0,0,0,5,5,0,0,5,0,0,0,0,0,0,0,2],[4,0,1,1,1,1,0,0,0,0,0,0,5,0,0,5,0,0,0,0,0,0,0,2],[4,0,0,0,0,0,0,0,0,0,0,0,5,5,5,5,0,0,1,0,0,1,1,2],[4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,1,0,0,0,0,2],[4,4,0,4,0,0,0,0,4,0,0,0,0,0,0,0,0,0,1,0,0,1,1,2],[4,4,0,0,0,0,5,0,4,4,0,4,4,4,0,0,0,0,1,0,0,0,0,2],[4,4,0,4,0,0,0,0,4,0,0,0,0,0,0,0,0,0,1,0,0,1,1,2],[4,4,0,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,1,0,0,0,0,2],[4,4,0,0,0,0,0,0,0,0,0,4,4,4,0,0,0,0,1,0,0,0,0,2],[4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,1,0,0,0,0,2],[4,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],this.staticObjects=[new s.StaticObject(16.5,8.5,0),new s.StaticObject(18.5,8.5,0),new s.StaticObject(11.5,8.5,1),new s.StaticObject(19.5,15.5,1),new s.StaticObject(19.5,22.5,1)],this.ceiling=5,this.floor=2,this.currentTileX=0,this.currentTileY=0,this.currentTime=0,this.previousTime=0,this.renderer=t,this.input=e,this.player=new i.Player(17,19)}return t.prototype.tick=function(){this.gameStep(),this.renderer.render(this),window.requestAnimationFrame(this.tick.bind(this))},t.prototype.gameStep=function(){if(this.input.keyQueue.length>0&&(console.log(this.input.keyQueue),null!=this.input.keyQueue.find((function(t){return"m"===t}))&&this.renderer.toggleMap(),this.input.clearQueue()),this.input.anyDirectional()){this.input.leftPressed?this.player.rotateBy(1.5):this.input.rightPressed&&this.player.rotateBy(-1.5);var t=0,e=0;if(this.input.upPressed)e+=this.player.direction.y*this.player.movementSpeed,t+=this.player.direction.x*this.player.movementSpeed;else{if(!this.input.downPressed)return;e-=this.player.direction.y*this.player.movementSpeed,t-=this.player.direction.x*this.player.movementSpeed}var r=this.player.posX+t,i=this.player.posY+e;if(!(i>this.walls.length||i<0||r>this.walls[0].length||r<0)&&(this.currentTileX=Math.floor(r),this.currentTileY=Math.floor(i),0===this.walls[this.currentTileY][this.currentTileX])){for(var s=0;s<this.staticObjects.length;s++)if(this.staticObjects[s].distanceTo(r,i)<=.5)return;this.player.posX=r,this.player.posY=i}}},t}();e.Game=n},322:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Input=void 0;var r=function(){function t(){this.upPressed=!1,this.downPressed=!1,this.leftPressed=!1,this.rightPressed=!1,this.keyQueue=[]}return t.prototype.attachEventListeners=function(t){var e=this;t.addEventListener("keydown",(function(t){"ArrowLeft"===t.key&&(e.leftPressed=!0),"ArrowRight"===t.key&&(e.rightPressed=!0),"ArrowUp"===t.key&&(e.upPressed=!0),"ArrowDown"===t.key&&(e.downPressed=!0)})),t.addEventListener("keyup",(function(t){"ArrowLeft"===t.key&&(e.leftPressed=!1),"ArrowRight"===t.key&&(e.rightPressed=!1),"ArrowUp"===t.key&&(e.upPressed=!1),"ArrowDown"===t.key&&(e.downPressed=!1),1===t.key.length&&e.keyQueue.push(t.key)}))},t.prototype.anyDirectional=function(){return!!(this.upPressed||this.downPressed||this.leftPressed||this.rightPressed)},t.prototype.clearQueue=function(){this.keyQueue=[]},t}();e.Input=r},993:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Player=void 0;var i=r(51),s=function(){function t(t,e){this.movementSpeed=.05,this.posX=t,this.posY=e,this.direction=new i.Vector(0,-1),this.plane=new i.Vector(.66,0)}return t.prototype.rotateBy=function(t){this.direction.rotateBy(t),this.plane.rotateBy(t)},t}();e.Player=s},983:function(t,e,r){var i=this&&this.__spreadArray||function(t,e,r){if(r||2===arguments.length)for(var i,s=0,n=e.length;s<n;s++)!i&&s in e||(i||(i=Array.prototype.slice.call(e,0,s)),i[s]=e[s]);return t.concat(i||Array.prototype.slice.call(e))};Object.defineProperty(e,"__esModule",{value:!0}),e.Renderer=void 0;var s=r(937),n=function(){function t(t,e,r,i,s,n){this.texWidth=64,this.texHeight=64,this.screenWidth=t,this.screenHeight=e,this.textures=i,this.sprites=s,this.canvas=r,this.canvas.width=this.screenWidth,this.canvas.height=this.screenHeight;var o=this.canvas.getContext("2d");if(null==o)throw new Error("Unable to get 2D rendering context from Canvas");this.drawContext=o,this.drawContext.imageSmoothingEnabled=!1,null!=n&&(this.depthContext=n.getContext("2d"))}return t.prototype.toggleMap=function(){this.mapVisible=!this.mapVisible},t.prototype.render=function(t){this.drawContext.fillStyle="#000",this.drawContext.fillRect(0,0,this.screenWidth,this.screenHeight),this.renderCeilingFloor(t),this.renderWalls(t),this.mapVisible&&this.renderMap(t)},t.prototype.renderCeilingFloor=function(t){var e=this.getBlockColor(t.ceiling);this.drawContext.fillStyle="hsl("+e.hue+","+e.saturation+"%,"+e.lightness/2+"%)",this.drawContext.fillRect(0,0,this.screenWidth,this.screenHeight/2);var r=this.getBlockColor(t.floor);this.drawContext.fillStyle="hsl("+r.hue+","+r.saturation+"%,"+r.lightness/4+"%)",this.drawContext.fillRect(0,this.screenHeight/2,this.screenWidth,this.screenHeight/2)},t.prototype.renderWalls=function(t){var e=[];e.fill(0,0,this.screenWidth);for(var r=0;r<this.screenWidth;r++){var s,n,o,h,a=2*r/this.screenWidth-1,l=t.player.direction.x+t.player.plane.x*a,p=t.player.direction.y+t.player.plane.y*a,c=Math.floor(t.player.posX),d=Math.floor(t.player.posY),u=Math.abs(1/l),y=Math.abs(1/p);l<0?(s=-1,o=(t.player.posX-c)*u):(s=1,o=(c+1-t.player.posX)*u),p<0?(n=-1,h=(t.player.posY-d)*y):(n=1,h=(d+1-t.player.posY)*y);for(var f,v,w=0;0===w;)o<h?(o+=u,c+=s,f=0):(h+=y,d+=n,f=1),t.walls[d][c]>0&&(w=1);v=0===f?(c-t.player.posX+(1-s)/2)/l:(d-t.player.posY+(1-n)/2)/p;var x,g=Math.floor(this.screenHeight/v),C=-g/2+this.screenHeight/2+0,m=g/2+this.screenHeight/2+0,P=t.walls[d][c]-1;x=0==f?t.player.posY+v*p:t.player.posX+v*l;var b=(x-=Math.floor(x))*this.texWidth;0==f&&l>0&&(b=this.texWidth-b),1==f&&p<0&&(b=this.texWidth-b);var k=Math.floor(this.texWidth+P*this.texWidth-b);this.drawContext.drawImage(this.textures,k,0,1,this.texHeight,r,C,1,m-C),1===f&&(this.drawContext.strokeStyle="rgba(0,0,0,0.6)",this.drawContext.beginPath(),this.drawContext.moveTo(r,C),this.drawContext.lineTo(r,m),this.drawContext.stroke()),e[r]=v}var M=i([],t.staticObjects,!0);M.sort((function(e,r){return r.distanceTo(t.player.posX,t.player.posY)-e.distanceTo(t.player.posX,t.player.posY)}));for(var S=0;S<M.length;S++){var W=M[S].x-t.player.posX,T=M[S].y-t.player.posY,j=1/(t.player.plane.x*t.player.direction.y-t.player.direction.x*t.player.plane.y),O=j*(t.player.direction.y*W-t.player.direction.x*T),H=j*(-t.player.plane.y*W+t.player.plane.x*T),X=Math.floor(this.screenWidth/2*(1+O/H)),Y=Math.abs(Math.floor(this.screenHeight/H)),_=Math.abs(Math.floor(this.screenHeight/H)),B=Math.floor(-_/2+X);B<0&&(B=0);var A=_/2+X;A>=this.screenWidth&&(A=this.screenWidth-1);for(var E=B;E<A;E++){var I=Math.floor((E-(-_/2+X))*this.texWidth/_);if(H>0&&E>0&&E<this.screenWidth&&H<e[E]){var R=M[S].sprite*this.texWidth+I,Q=-Y/2+this.screenHeight/2+0;this.drawContext.drawImage(this.sprites,R,0,1,this.texHeight,E,Q,1,Y),e[E]=H}}}if(null!=this.depthContext)for(var V=t.walls.length,L=0;L<this.screenWidth;L++){var D=e[L]/V*100;this.depthContext.strokeStyle="hsl(0, 0%, ".concat(100-D,"%)"),this.depthContext.beginPath(),this.depthContext.moveTo(L,0),this.depthContext.lineTo(L,this.screenHeight),this.depthContext.stroke()}},t.prototype.renderMap=function(t){var e=this;this.drawContext.strokeStyle="#f0f";for(var r=0;r<t.walls.length;r++)for(var i=0;i<t.walls[r].length;i++){var s=this.getBlockColor(t.walls[r][i]);this.drawContext.fillStyle="hsl("+s.hue+","+s.saturation+"%,"+s.lightness+"%)",this.drawContext.fillRect(8*i,8*r,8,8),t.currentTileX===i&&t.currentTileY===r&&this.drawContext.strokeRect(8*i,8*r,8,8)}this.drawContext.strokeStyle="#f77",t.staticObjects.forEach((function(t){e.drawCircle(8*t.x,8*t.y,4)}));var n=8*t.player.posX,o=8*t.player.posY;this.drawContext.strokeStyle="#fff",this.drawCircle(n,o,4),this.drawContext.beginPath(),this.drawContext.moveTo(n,o),this.drawContext.lineTo(n+8*t.player.direction.x,o+8*t.player.direction.y),this.drawContext.stroke()},t.prototype.drawCircle=function(t,e,r){this.drawContext.beginPath(),this.drawContext.arc(t,e,r,0,2*Math.PI),this.drawContext.stroke()},t.prototype.getBlockColor=function(t){var e=0,r=100,i=50;return 0===t?(r=0,i=0):e=40*t,new s.Color(e,r,i)},t}();e.Renderer=n},584:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.StaticObject=void 0;var r=function(){function t(t,e,r){this.x=t,this.y=e,this.sprite=r}return t.prototype.distanceTo=function(t,e){return(t-this.x)*(t-this.x)+(e-this.y)*(e-this.y)},t}();e.StaticObject=r},51:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Vector=void 0;var r=function(){function t(t,e){this.x=t,this.y=e}return t.prototype.rotateBy=function(t){t=-t*(Math.PI/180);var e=Math.cos(t),r=Math.sin(t),i=Math.round(1e4*(this.x*e-this.y*r))/1e4,s=Math.round(1e4*(this.x*r+this.y*e))/1e4;this.x=i,this.y=s},t}();e.Vector=r}},e={};function r(i){var s=e[i];if(void 0!==s)return s.exports;var n=e[i]={exports:{}};return t[i].call(n.exports,n,n.exports,r),n.exports}(()=>{var t=r(934),e=r(322),i=r(983),s=new e.Input;s.attachEventListeners(document.getElementsByTagName("body")[0]);var n=document.getElementById("canvas"),o=document.getElementById("depth"),h=document.getElementById("textures"),a=document.getElementById("sprites"),l=new i.Renderer(1024,768,n,h,a,o);new t.Game(l,s).tick()})()})();
//# sourceMappingURL=main.36e63177aa606dcc858d.js.map