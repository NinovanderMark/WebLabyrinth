(()=>{"use strict";var t={937:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Color=void 0;e.Color=function(t,e,i){this.hue=t,this.saturation=e,this.lightness=i}},934:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Game=void 0;var r=i(993),s=i(584),n=i(51),o=function(){function t(t,e){this.walls=[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2],[4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,3,0,0,0,2],[4,0,0,0,0,0,0,2,2,2,2,2,2,0,0,3,0,3,3,3,0,0,0,2],[4,0,3,3,0,0,0,2,0,0,0,0,2,0,0,0,0,0,0,3,0,0,0,2],[4,0,3,3,0,0,2,2,0,2,2,0,2,0,0,3,3,3,0,3,0,0,0,2],[4,0,3,3,0,0,2,0,0,0,2,0,2,0,0,3,0,0,0,3,0,0,0,2],[4,0,3,3,0,0,2,0,0,0,0,0,2,0,0,3,0,3,3,3,0,0,0,2],[4,0,0,0,0,0,2,0,0,0,2,2,2,0,0,0,0,0,0,0,0,0,0,2],[4,0,0,0,0,0,2,2,0,2,2,0,0,0,0,3,0,3,0,3,0,0,0,2],[4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2],[4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2],[4,0,1,0,0,1,0,0,0,0,0,5,5,5,5,5,0,0,0,0,0,0,0,2],[4,0,0,0,0,1,0,0,0,0,0,0,0,0,0,5,0,0,0,0,0,0,0,2],[4,0,0,0,0,1,0,0,0,0,0,5,5,0,0,5,0,0,0,0,0,0,0,2],[4,0,1,1,1,1,0,0,0,0,0,0,5,0,0,5,0,0,0,0,0,0,0,2],[4,0,0,0,0,0,0,0,0,0,0,0,5,5,5,5,0,0,1,0,0,1,1,2],[4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,1,0,0,0,0,2],[4,4,0,4,0,0,0,0,4,0,0,0,0,0,0,0,0,0,1,0,0,1,1,2],[4,4,0,0,0,0,5,0,4,4,0,4,4,4,0,0,0,0,1,0,0,0,0,2],[4,4,0,4,0,0,0,0,4,0,0,0,0,0,0,0,0,0,1,0,0,1,1,2],[4,4,0,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,1,0,0,0,0,2],[4,4,0,0,0,0,0,0,0,0,0,4,4,4,0,0,0,0,1,0,0,0,0,2],[4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,1,0,0,0,0,2],[4,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],this.staticObjects=[new s.StaticObject(16.5,8.5,0),new s.StaticObject(18.5,8.5,0),new s.StaticObject(11.5,8.5,1),new s.StaticObject(19.5,15.5,1),new s.StaticObject(19.5,22.5,1)],this.ceiling=5,this.floor=2,this.currentTileX=0,this.currentTileY=0,this.currentTime=0,this.previousTime=0,this.renderer=t,this.input=e,this.player=new r.Player(17,19)}return t.prototype.tick=function(){this.gameStep(),this.renderer.render(this),window.requestAnimationFrame(this.tick.bind(this))},t.prototype.gameStep=function(){if(this.input.keyQueue.length>0&&(console.log(this.input.keyQueue),null!=this.input.keyQueue.find((function(t){return"m"===t}))&&this.renderer.toggleMap(),this.input.clearQueue()),this.input.anyDirectional()||null!=this.input.mouseDragStart){var t=this.getMovementFromInput();if(0!==t.x||0!==t.y){var e=this.player.posX+t.x,i=this.player.posY+t.y;if(!(i>this.walls.length||i<0||e>this.walls[0].length||e<0)&&(this.currentTileX=Math.floor(e),this.currentTileY=Math.floor(i),0===this.walls[this.currentTileY][this.currentTileX])){for(var r=0;r<this.staticObjects.length;r++)if(this.staticObjects[r].distanceTo(e,i)<=.5)return;this.player.posX=e,this.player.posY=i}}}},t.prototype.getMovementFromInput=function(){this.input.leftPressed?this.player.rotateBy(1.5):this.input.rightPressed&&this.player.rotateBy(-1.5);var t=0,e=0;if(this.input.upPressed?(e+=this.player.direction.y*this.player.movementSpeed,t+=this.player.direction.x*this.player.movementSpeed):this.input.downPressed&&(e-=this.player.direction.y*this.player.movementSpeed,t-=this.player.direction.x*this.player.movementSpeed),null!=this.input.mouseDragStart){this.player.rotateBy(.01*(this.input.mouseDragStart.x-this.input.mousePosition.x));var i=this.input.mouseDragStart.y-this.input.mousePosition.y;i>.01?(e=this.player.direction.y*Math.min(i,this.player.movementSpeed),t=this.player.direction.x*Math.min(i,this.player.movementSpeed)):i<-.01&&(e=this.player.direction.y*Math.max(i,-this.player.movementSpeed),t=this.player.direction.x*Math.max(i,-this.player.movementSpeed))}return new n.Vector(t,e)},t}();e.Game=o},322:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Input=void 0;var r=i(51),s=function(){function t(){this.upPressed=!1,this.downPressed=!1,this.leftPressed=!1,this.rightPressed=!1,this.leftMousePressed=!1,this.mouseDragStart=null,this.mousePosition=new r.Vector(0,0),this.keyQueue=[]}return t.prototype.attachEventListeners=function(t){var e=this;t.addEventListener("keydown",(function(t){"ArrowLeft"===t.key&&(e.leftPressed=!0),"ArrowRight"===t.key&&(e.rightPressed=!0),"ArrowUp"===t.key&&(e.upPressed=!0),"ArrowDown"===t.key&&(e.downPressed=!0)})),t.addEventListener("keyup",(function(t){"ArrowLeft"===t.key&&(e.leftPressed=!1),"ArrowRight"===t.key&&(e.rightPressed=!1),"ArrowUp"===t.key&&(e.upPressed=!1),"ArrowDown"===t.key&&(e.downPressed=!1),1===t.key.length&&e.keyQueue.push(t.key)})),t.addEventListener("mousedown",(function(i){if(0===i.button){var s=t.getBoundingClientRect();e.leftMousePressed=!0,e.mouseDragStart=new r.Vector(i.clientX-s.left,i.clientY-s.top)}})),t.addEventListener("mousemove",(function(i){var s=t.getBoundingClientRect();e.mousePosition=new r.Vector(i.clientX-s.left,i.clientY-s.top)})),t.addEventListener("mouseup",(function(t){0===t.button&&(e.leftMousePressed=!1,e.mouseDragStart=null)})),t.addEventListener("touchstart",(function(i){e.leftMousePressed=!0;var s=t.getBoundingClientRect(),n=i.changedTouches.item(0).clientX-s.left,o=i.changedTouches.item(0).clientY-s.top;e.mouseDragStart=new r.Vector(n,o)})),t.addEventListener("touchmove",(function(i){var s=t.getBoundingClientRect(),n=i.changedTouches.item(0).clientX-s.left,o=i.changedTouches.item(0).clientY-s.top;e.mousePosition=new r.Vector(n,o)})),t.addEventListener("touchend",(function(t){e.leftMousePressed=!1,e.mouseDragStart=null}))},t.prototype.anyDirectional=function(){return!!(this.upPressed||this.downPressed||this.leftPressed||this.rightPressed)},t.prototype.clearQueue=function(){this.keyQueue=[]},t}();e.Input=s},993:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Player=void 0;var r=i(51),s=function(){function t(t,e){this.movementSpeed=.05,this.posX=t,this.posY=e,this.direction=new r.Vector(0,-1),this.plane=new r.Vector(.66,0)}return t.prototype.rotateBy=function(t){this.direction.rotateBy(t),this.plane.rotateBy(t)},t}();e.Player=s},983:function(t,e,i){var r=this&&this.__spreadArray||function(t,e,i){if(i||2===arguments.length)for(var r,s=0,n=e.length;s<n;s++)!r&&s in e||(r||(r=Array.prototype.slice.call(e,0,s)),r[s]=e[s]);return t.concat(r||Array.prototype.slice.call(e))};Object.defineProperty(e,"__esModule",{value:!0}),e.Renderer=void 0;var s=i(937),n=function(){function t(t,e,i,r,s,n){this.texWidth=64,this.texHeight=64,this.screenWidth=t,this.screenHeight=e,this.textures=r,this.sprites=s,this.canvas=i,this.canvas.width=this.screenWidth,this.canvas.height=this.screenHeight;var o=this.canvas.getContext("2d");if(null==o)throw new Error("Unable to get 2D rendering context from Canvas");this.drawContext=o,this.drawContext.imageSmoothingEnabled=!1,null!=n&&(this.depthContext=n.getContext("2d"))}return t.prototype.toggleMap=function(){this.mapVisible=!this.mapVisible},t.prototype.render=function(t){this.drawContext.fillStyle="#000",this.drawContext.fillRect(0,0,this.screenWidth,this.screenHeight),this.renderCeilingFloor(t),this.renderWalls(t),this.mapVisible&&this.renderMap(t)},t.prototype.renderCeilingFloor=function(t){var e=this.getBlockColor(t.ceiling);this.drawContext.fillStyle="hsl("+e.hue+","+e.saturation+"%,"+e.lightness/2+"%)",this.drawContext.fillRect(0,0,this.screenWidth,this.screenHeight/2);var i=this.getBlockColor(t.floor);this.drawContext.fillStyle="hsl("+i.hue+","+i.saturation+"%,"+i.lightness/4+"%)",this.drawContext.fillRect(0,this.screenHeight/2,this.screenWidth,this.screenHeight/2)},t.prototype.renderWalls=function(t){var e=[];e.fill(0,0,this.screenWidth);for(var i=0;i<this.screenWidth;i++){var s,n,o,h,a=2*i/this.screenWidth-1,l=t.player.direction.x+t.player.plane.x*a,c=t.player.direction.y+t.player.plane.y*a,d=Math.floor(t.player.posX),p=Math.floor(t.player.posY),u=Math.abs(1/l),y=Math.abs(1/c);l<0?(s=-1,o=(t.player.posX-d)*u):(s=1,o=(d+1-t.player.posX)*u),c<0?(n=-1,h=(t.player.posY-p)*y):(n=1,h=(p+1-t.player.posY)*y);for(var f,v,g=0;0===g;)o<h?(o+=u,d+=s,f=0):(h+=y,p+=n,f=1),t.walls[p][d]>0&&(g=1);v=0===f?(d-t.player.posX+(1-s)/2)/l:(p-t.player.posY+(1-n)/2)/c;var w,x=Math.floor(this.screenHeight/v),m=-x/2+this.screenHeight/2+0,C=x/2+this.screenHeight/2+0,P=t.walls[p][d]-1;w=0==f?t.player.posY+v*c:t.player.posX+v*l;var M=(w-=Math.floor(w))*this.texWidth;0==f&&l>0&&(M=this.texWidth-M),1==f&&c<0&&(M=this.texWidth-M);var b=Math.floor(this.texWidth+P*this.texWidth-M);this.drawContext.drawImage(this.textures,b,0,1,this.texHeight,i,m,1,C-m),1===f&&(this.drawContext.strokeStyle="rgba(0,0,0,0.6)",this.drawContext.beginPath(),this.drawContext.moveTo(i,m),this.drawContext.lineTo(i,C),this.drawContext.stroke()),e[i]=v}var S=r([],t.staticObjects,!0);S.sort((function(e,i){return i.distanceTo(t.player.posX,t.player.posY)-e.distanceTo(t.player.posX,t.player.posY)}));for(var k=0;k<S.length;k++){var T=S[k].x-t.player.posX,W=S[k].y-t.player.posY,B=1/(t.player.plane.x*t.player.direction.y-t.player.direction.x*t.player.plane.y),X=B*(t.player.direction.y*T-t.player.direction.x*W),Y=B*(-t.player.plane.y*T+t.player.plane.x*W),j=Math.floor(this.screenWidth/2*(1+X/Y)),O=Math.abs(Math.floor(this.screenHeight/Y)),E=Math.abs(Math.floor(this.screenHeight/Y)),H=Math.floor(-E/2+j);H<0&&(H=0);var _=E/2+j;_>=this.screenWidth&&(_=this.screenWidth-1);for(var D=H;D<_;D++){var R=Math.floor((D-(-E/2+j))*this.texWidth/E);if(Y>0&&D>0&&D<this.screenWidth&&Y<e[D]){var I=S[k].sprite*this.texWidth+R,V=-O/2+this.screenHeight/2+0;this.drawContext.drawImage(this.sprites,I,0,1,this.texHeight,D,V,1,O),e[D]=Y}}}if(null!=this.depthContext)for(var A=t.walls.length,L=0;L<this.screenWidth;L++){var Q=e[L]/A*100;this.depthContext.strokeStyle="hsl(0, 0%, ".concat(100-Q,"%)"),this.depthContext.beginPath(),this.depthContext.moveTo(L,0),this.depthContext.lineTo(L,this.screenHeight),this.depthContext.stroke()}},t.prototype.renderMap=function(t){var e=this;this.drawContext.strokeStyle="#f0f";for(var i=0;i<t.walls.length;i++)for(var r=0;r<t.walls[i].length;r++){var s=this.getBlockColor(t.walls[i][r]);this.drawContext.fillStyle="hsl("+s.hue+","+s.saturation+"%,"+s.lightness+"%)",this.drawContext.fillRect(8*r,8*i,8,8),t.currentTileX===r&&t.currentTileY===i&&this.drawContext.strokeRect(8*r,8*i,8,8)}this.drawContext.strokeStyle="#f77",t.staticObjects.forEach((function(t){e.drawCircle(8*t.x,8*t.y,4)}));var n=8*t.player.posX,o=8*t.player.posY;this.drawContext.strokeStyle="#fff",this.drawCircle(n,o,4),this.drawContext.beginPath(),this.drawContext.moveTo(n,o),this.drawContext.lineTo(n+8*t.player.direction.x,o+8*t.player.direction.y),this.drawContext.stroke()},t.prototype.drawCircle=function(t,e,i){this.drawContext.beginPath(),this.drawContext.arc(t,e,i,0,2*Math.PI),this.drawContext.stroke()},t.prototype.getBlockColor=function(t){var e=0,i=100,r=50;return 0===t?(i=0,r=0):e=40*t,new s.Color(e,i,r)},t}();e.Renderer=n},584:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.StaticObject=void 0;var i=function(){function t(t,e,i){this.x=t,this.y=e,this.sprite=i}return t.prototype.distanceTo=function(t,e){return(t-this.x)*(t-this.x)+(e-this.y)*(e-this.y)},t}();e.StaticObject=i},51:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Vector=void 0;var i=function(){function t(t,e){this.x=t,this.y=e}return t.prototype.rotateBy=function(t){t=-t*(Math.PI/180);var e=Math.cos(t),i=Math.sin(t),r=Math.round(1e4*(this.x*e-this.y*i))/1e4,s=Math.round(1e4*(this.x*i+this.y*e))/1e4;this.x=r,this.y=s},t}();e.Vector=i}},e={};function i(r){var s=e[r];if(void 0!==s)return s.exports;var n=e[r]={exports:{}};return t[r].call(n.exports,n,n.exports,i),n.exports}(()=>{var t=i(934),e=i(322),r=i(983),s=new e.Input;s.attachEventListeners(document.getElementsByTagName("body")[0]);var n=document.getElementById("canvas"),o=document.getElementById("depth"),h=document.getElementById("textures"),a=document.getElementById("sprites"),l=new r.Renderer(1024,768,n,h,a,o);new t.Game(l,s).tick()})()})();
//# sourceMappingURL=main.b48adedbc2fb97892c4e.js.map